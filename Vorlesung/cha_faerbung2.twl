\chapter{FÃ¤rbung II}
\label{cha:faerbung2}


\pagebreak

\section{Rekursives Raytracing}
\label{sec:faerbungRayTracing}

\begin{description}
\item[Ziel:] einheitlicher Ansatz fÃ¼r:
  \begin{itemize}
  \item Sichtbarkeitsanalyse
  \item Schatten
  \item Reflexion, Spiegelungen
  \item Refraktion (Brechung)
  \end{itemize}
\end{description}

\begin{bemerkung}
  Schattenwurf, Spiegelungen und Lichtbrechung entstehen dadurch, dass
  das von der Lichtquelle kommende Licht das sichtbare Objekt $Oâ‚–$
  nicht direkt erreicht (Interaktion mit anderen Objekten).

  \begin{itemize}
  \item[â‡’] Diese Effekte kÃ¶nnen nur mit einem
    \emph{nicht-lokalen Modell\index{nicht-lokales Modell}
      (Modell der Ordnung > 0\index{Modell der Ordnung > 0})} berÃ¼cksichtigt werden.
  \end{itemize}
\end{bemerkung}


\subsection{Das Brechungsgesetz}

Einfallender und gebrochener Strahl liegen in derselben Ebene, und es
gilt
\[ \frac{\sin Î±_{\mathtxtit{I}}}{\sin Î±_{\mathtxtit{II}}} = \frac{Î·_{\mathtxtit{I}}}{Î·_{\mathtxtit{II}}}
  \qquad
  \white{\frac{\black{\text{\cmt{Brechungsindex von Medium I}}}}%
    {\black{\text{\cmt{Brechungsindex von Medium II}} \,\text.}}} \]

\begin{center}
  \scalebox{0.5}{\huge\input{fig_farbeRaytracingBrechungsgesetz}}%Î±
\end{center}

\begin{bemerkung}
  $Î·$ hÃ¤ngt \iA von der WellenlÃ¤nge ab.
\end{bemerkung}


\subsection{Der Raytracing-Ansatz nach Whitted}

\begin{description}
\item[Beobachtung:] Bei einem bestimmten Pixel sei der Punkt $\point{P}$ eines Objekts
  sichtbar.
  Das von $\point{P}$ ins Auge fallende Licht setzt sich zusammen
  aus
  \begin{itemize}
  \item dem bei $\point{P}$ einfallenden, ins Auge
    \emph{reflektierten} Licht und
  \item dem bei $\point{P}$ austretenden, in Augenrichtung
    \emph{gebrochenen} Licht
  \end{itemize}
  (jeweils direkt von den Lichtquellen und/oder bereits vorher â€“
  \evtl mehrfach â€“ gespiegelt und/oder gebrochen).
  \personHidden{-80mm}{John Turner Whitted}{?, Durham, North Carolina}{}%
  {Elektroingenieur, Informatiker}%
  {person_Whitted}{}%
  {\urlpers{https://ece.ncsu.edu/honor/turner-whitted/}}%
  {}%Lizenz unklar

  \begin{center}
    \scalebox{0.5}{\huge\input{fig_farbeRaytracingWhitted}}
  \end{center}
\end{description}

\pagebreak

\minisec{Ansatz}

\begin{equation}
  \label{eq:whitted1}
  I\fk{\point{P}', \point{P}} =
  g\fk{\point{P}', \point{P}}
  Â· \mk{Îµ\fk{\point{P}', \point{P}}
    + âˆ«_{â„Â³} Ï\fk{\point{P}'', \point{P}', \point{P}} I\fk{\point{P}'', \point{P}'} \, d\point{P}''}
\end{equation}

\begin{tabular}{lp{21cm}}
  $I\fk{\point{P}', \point{P}}$: & IntensitÃ¤t des vom Punkt
  $\point{P}'$ nach $\point{P}$ gestrahlten Lichts \\
  $g\fk{\point{P}', \point{P}}$: & â€DÃ¤mpfungsfaktorâ€œ \par
  \qquad $= 0$, falls $\point{P}'$ von $\point{P}$ aus nicht sichtbar ist, \par
  \qquad proportional zu $\frac{1}{\norm[2]{\point{P}' - \point{P}}Â²}$ sonst \\
  $Îµ\fk{\point{P}', \point{P}}$: & Eigenemission von $\point{P}'$ nach $\point{P}$ \\
  $I\fk{\point{P}'', \point{P}'}$: & IntensitÃ¤t des bei $\point{P}'$ von einem Punkt $\point{P}''$
  einfallenden Lichts \\
  $Ï\fk{\point{P}'', \point{P}', \point{P}}$: &
  Reflexions-/Brechungskoeffizient fÃ¼r das von $\point{P}''$ bei
  $\point{P}'$ eintreffende und nach $\point{P}$ weitergegebene Licht
\end{tabular}

\begin{bemerkung}
  In dieser Formulierung werden Lichtquellen wie alle anderen Objekte
  behandelt.
\end{bemerkung}

\begin{description}
\item[Problem:] Die kontinuierliche Formulierung \eqref{eq:whitted1} ist fÃ¼r die
  praktische Rechnung nicht geeignet.
\end{description}

\pagebreak

\minisec{Erste Umformulierung}

\begin{equation}
  \label{eq:whitted2}
  I\fk{\vektor{r}, \point{P}} = g\fk{\point{P}', \point{P}}
  Â· \mk{Îµ\fk{\point{P}', \point{P}}
    + âˆ« Ï\fk{\vektor{r}', \point{P}', -\vektor{r}} I\fk{\vektor{r}', \point{P}'} \, d\vektor{r}'}
\end{equation}

\begin{tabular}{lp{21cm}}
  $I\fk{\vektor{r}, \point{P}}$: & aus Richtung $\vektor{r}$ bei $\point{P}$ eintreffendes Licht \\
  $\point{P}'$: & der erste auf einem Objekt liegende Punkt, wenn man von $\point{P}$
  aus in Richtung $\vektor{r}$ geht \\
  $Ï\fk{\vektor{r}', \point{P}', -\vektor{r}}$: &
  Reflexions-/Brechungskoeffizient fÃ¼r das aus Richtung $\vektor{r}'$
  bei $\point{P}'$ eintreffende und in Richtung $-\vektor{r}$ weitergeleitete Licht \\
  $d\vektor{r}'$: & Integration Ã¼ber alle mÃ¶glichen Richtungen
\end{tabular}

\minisec{Vereinfachungen}

\begin{itemize}
\item BerÃ¼cksichtige in \eqref{eq:whitted2} nicht alle Richtungen
  $\vektor{r}'$ sondern nur die beiden durch Spiegel- und
  Brechungsgesetz gegebenen Richtungen:

  \begin{center}
    \scalebox{0.5}{\huge\input{fig_farbeRaytracingRichtungen}}%â‚›
  \end{center}

  (Aus Richtung $\vektor{r}â‚›$ \bzw $\vektor{r}_b$ einfallendes
  Licht wird in Richtung $-\vektor{r}$ gespiegelt \bzw gebrochen.)

  \pagebreak

\item Lichtquellen werden speziell behandelt.

  \begin{itemize}
  \item $Îµ â‰¡ 0$
    (Die betrachteten Objekte emittieren nicht selbst.)

  \item FÃ¼r das \emph{direkt} von den Lichtquellen bei
    $\point{P}'$ eintreffende Licht wird eine Kombination von
    ambientem, diffusem und winkelabhÃ¤ngigem Anteil angesetzt.
  \end{itemize}
\end{itemize}

\begin{bemerkungen} \mbox{}
  \begin{enumerate}
  \item Lichtbrechung und Spiegelung an Objekten werden
    \emph{â€zu perfektâ€œ} nachgebildet. (In der RealitÃ¤t sind
    die OberflÃ¤chen nicht ganz glatt, \dH nach mehrfacher
    Spiegelung/Brechung â€verschwimmtâ€œ das Bild des Objekts.)

  \item Diffuse Reflexion wird nicht korrekt modelliert:

    \begin{center}
      \scalebox{0.5}{\huge\input{fig_farbeRaytracingProblemDiffus}}
    \end{center}
  \end{enumerate}
  \ReachedZoom{WS20/21}{09}{2021/01/07}
  \Reached{WS21/22}{09}{2021/12/09}
\end{bemerkungen}

\pagebreak

\vspace*{-26mm}
\begin{algorithmus} \mbox{}
  \begin{AlgListInline}
    Algorithmus Bilderzeugung mit rekursivem Raytracing

    fÃ¼r alle Pixel der Pixmap
    Â°Â°Â°$\point{P}$ := ein zum Pixel gehÃ¶riger Punkt in der Projektionsebene
    Â°Â°Â°$\vektor{r}$ := die zu diesem Punkt gehÃ¶rige Âºâ€ÂºBlickrichtungÂºâ€œÂº
    Â°Â°Â°Pixelwert := I($\vektor{r}$, $\point{P}$, $1$)
  \end{AlgListInline}
\end{algorithmus}

\enlargethispage{40mm}
\vspace*{-9mm}
\begin{algorithmus} \mbox{}
  \begin{AlgListInline}
    Algorithmus I($\vektor{r}$, $\point{P}$, $t$)
    // bestimmt, wie viel Licht aus Richtung $\vektor{r}$ beim Punkt $\point{P}$ einfÃ¤llt; $t$ ist die Rekursionstiefe

    verfolge den von $\point{P}$ ausgehenden Strahl in Richtung $\vektor{r}$ ÂºbisÂº zum nÃ¤chstgelegenen Schnittpunkt $\point{P}'$
    Â°Â°Â°Â°Â°mit einem Objekt $Oâ‚–$
    wenn es keinen solchen Schnittpunkt gibt
    Â°Â°Â°I($\vektor{r}$, $\point{P}$, $t$) := Âºâ€ÂºHintergrundÂºâ€œÂº
    sonst
    Â°Â°Â°$I$ := $Iâ‚ Â· R_{k,a}$Â°Â°Â°Â°Â°// ambienter Anteil
    Â°Â°Â°// @\small\begin{tabular}[t]{ll} $Iâ‚$: & IntensitÃ¤t des ambienten Lichts \\ $R_{k,a}$: & Reflexionskoeffizient fÃ¼r ambientes Licht \end{tabular}@
  \end{AlgListInline}

  \pagebreak

  \enlargethispage{10mm}
  \vspace*{-20mm}
  \begin{AlgListInline}
    Â°Â°Â°// Fortsetzung von â€sonstâ€œ
    Â°Â°Â°// diffuser und winkelabhÃ¤ngiger â€direkterâ€œ Anteil
    Â°Â°Â°fÃ¼r alle Lichtquellen $Lâ‚—$
    Â°Â°Â°Â°Â°Â°wenn $\point{P}'$ von $Lâ‚—$ aus sichtbar ist
    Â°Â°Â°Â°Â°Â°Â°Â°Â°$I$ := $I + g\fk{Lâ‚—, \point{P}'} Â· Iâ‚— Â· \mk{\rk{\vektor{n}_{\point{P}'}áµ€ Â· \vektor{r}â‚—} Â· R_{k,d} + \rk{-\vektor{r}áµ€ Â· \vektor{s}â‚—}^{Î½â‚–} Â· R_{k,w}}$
    Â°Â°Â°Â°Â°Â°Â°Â°Â°// @\raisebox{0pt}[0bp][78pt]{\small\begin{tabular}[t]{ll} $g\fk{Lâ‚—, \point{P}'}$: & DÃ¤mpfungsfaktor (abhÃ¤ngig von Entfernung, Medium und $Î»$) \\ $Iâ‚—$: & IntensitÃ¤t von $Lâ‚—$ \\ $\vektor{n}_{\point{P}'}$: & Normale an $Oâ‚–$ in $\point{P}'$ \\ $\vektor{r}â‚—$: & Richtung von $\point{P}'$ nach $Lâ‚—$ \\ $R_{k,d}$: & Reflexionskoeffizient diffus \\ $-\vektor{r}$: & â€Blickrichtungâ€œ von $\point{P}'$ aus \\ $\vektor{s}â‚—$: & Spiegelrichtung fÃ¼r das von $Lâ‚—$ bei $\point{P}'$ eintreffende Licht \\ $R_{k,w}$: & Reflexionskoeffizient winkelabhÃ¤ngig \end{tabular}}@
    Â°Â°Â°wenn $Oâ‚–$ spiegelt und $t < t_{\max}$Â°Â°Â°Â°Â°// Spiegelung
    Â°Â°Â°Â°Â°Â°Â°Â°Â°// @\small\begin{tabular}[t]{ll} $t_{\max}$: & maximale Rekursionstiefe \end{tabular}@
    Â°Â°Â°Â°Â°Â°berechne die zu $\vektor{r}$ gehÃ¶rige Spiegelrichtung $\vektor{r}â‚›$
    Â°Â°Â°Â°Â°Â°$I$ := $I + \mdef{\text{I}\fk{\vektor{r}â‚›, \point{P}', t + 1}} Â· R_{k,s}$Â°Â°Â°Â°Â°// Rekursion!
    Â°Â°Â°Â°Â°Â°Â°Â°Â°// @\small\begin{tabular}[t]{ll} $R_{k,s}$: & Spiegelungskoeffizient \end{tabular}@
    Â°Â°Â°wenn $Oâ‚–$ Licht bricht und $t < t_{\max}$Â°Â°Â°Â°Â°// Lichtbrechung
    Â°Â°Â°Â°Â°Â°berechne die zu $\vektor{r}$ gehÃ¶rige Brechungsrichtung $\vektor{r}_b$
    Â°Â°Â°Â°Â°Â°$I$ := $I + \mdef{\text{I}\fk{\vektor{r}_b, \point{P}', t + 1}} Â· R_{k,b}$Â°Â°Â°Â°Â°// Rekursion!
    Â°Â°Â°Â°Â°Â°Â°Â°Â°// @\small\begin{tabular}[t]{ll} $R_{k,b}$: & Brechungskoeffizient \end{tabular}@
    Â°Â°Â°I($\vektor{r}$, $\point{P}$, $t$) := $I$
  \end{AlgListInline}
\end{algorithmus}

\pagebreak

\vspace*{-16mm}
\begin{bemerkungen} \mbox{}
  \begin{enumerate}
  \item Die Lichtstrahlen werden vom Betrachter aus bis zur
    Lichtquelle zurÃ¼ckverfolgt (entgegen der Ausbreitungsrichtung
    des Lichts).

  \item $t_{\max}$ gibt an, wie viele Interaktionen mit Objekten auf
    dem Weg von der Lichtquelle bis zum Betrachter berÃ¼cksichtigt
    werden.

    FÃ¼r $t_{\max} = 1$ ergibt sich im Wesentlichen das
    Beleuchtungsmodell von Phong (mit integrierter
    Schattenanalyse).

  \item Die Operationen

    \begin{quote}
      â€\AlgInline!verfolge den von $\point{P}$ ausgehenden Strahl in Richtung $\vektor{r}$! â€¦â€œ
    \end{quote}

    und

    \begin{quote}
      â€\AlgInline!wenn $\point{P}'$ von $Lâ‚—$ aus sichtbar ist!â€œ
    \end{quote}

    sind sehr Ã¤hnlich.
    In beiden FÃ¤llen muss festgestellt werden, welches Objekt der
    Strahl zuerst trifft.

    Diese beiden Operationen verbrauchen den grÃ¶ÃŸten Teil der
    gesamten Rechenzeit.

    \begin{description}
    \item[â€naiver Ansatzâ€œ:] PrÃ¼fe fÃ¼r alle Objekte $Oâ‚–$, ob sie vom Strahl
      getroffen werden, und bestimme \ggf den nÃ¤chstgelegenen
      Schnittpunkt.
    \end{description}

    typische GrÃ¶ÃŸenordnungen:
    \begin{alignat*}{3}
      p &= \text{Anzahl der Pixel in der Pixmap} &&= 10â¶ \\
      n &= \text{Anzahl der Objekte} &&= 10âµ \\
      m &= \text{Anzahl der Lichtquellen} &&= 3 \\
      t_{\max} &= \text{maximale Rekursionstiefe} &&= 5
    \end{alignat*}

    \begin{itemize}
    \item[â‡’] Es mÃ¼ssen insgesamt bis zu
      \[ p Â· \underbrace{\rk{2^{t_{\max}} - 1} (m + 1)}_{\text{Aufspaltung des zum Pixel gehÃ¶renden Strahls}} \]
      Strahlen verfolgt werden.

    \item[â‡’] bis zu
      \begin{align*}
        &p Â· \rk{2^{t_{\max}} - 1} (m + 1) Â· n \\
        &= 10â¶ Â· 124 Â· 10âµ \\
        &â‰ˆ \mathbf{\mdef{10Â¹Â³}} \text{ \emph{Schnitttests!}}
      \end{align*}
      
    \item[â‡’] Raytracing ist â€“ naiv implementiert â€“ nicht
      praktikabel.
    \end{itemize}
  \end{enumerate}
\end{bemerkungen}

\pagebreak

\pngpage{Bilder/uebung/rt-vorl-d1}

\pngpage{Bilder/uebung/rt-vorl-d2}

\pngpage{Bilder/uebung/rt-vorl-d3}

\pngpage{Bilder/uebung/rt-vorl-d4}

\pngpage{Bilder/uebung/rt-vorl-d5}

\pngpage{Bilder/uebung/rt-vorl-d6}

\pagebreak


\Reached{WS19/20}{10}{2019/12/12}
\subsection{Beschleunigung der Strahlverfolgung (I)}

\begin{description}
\item[Motivation:] Der zeitaufwÃ¤ndigste Teil des Raytracing ist die Bestimmung der
  Schnittpunkte der Strahlen mit den jeweils nÃ¤chstgelegenen
  Objekten.

  \begin{itemize}
  \item[â‡’] Versuche, die Anzahl der erforderlichen
    Schnitttests zu reduzieren
    (nicht fÃ¼r jeden Strahl alle Objekte testen).

  \item[â‡’] \emph{Vorverarbeitung} notwendig
  \end{itemize}

\item[Ansatz:] Unterteile die Szene in Gebiete $Gáµ¢$ und bestimme fÃ¼r jedes
  Gebiet die Menge $Láµ¢$ der (zumindest teilweise) in $Gáµ¢$
  liegenden Objekte.

  \begin{itemize}
  \item[â‡’] Ein Strahl kann Objekt $Oâ‚–$ nicht treffen,
    wenn $Oâ‚–$ nicht in den Listen $Láµ¢$ der vom Strahl
    berÃ¼hrten Gebiete $Gáµ¢$ liegt.
  \end{itemize}

\item[Fragen:] \mbox{}

  \begin{itemize}
  \item Wie sind die $Gáµ¢$ zu wÃ¤hlen?

  \item Wie bestimmt man die vom Strahl berÃ¼hrten $Gáµ¢$?
  \end{itemize}
\end{description}

\pagebreak

\minisec{Zellraster-Unterteilung}

(\vgl Abschnitt~\ref{subsec:sichtbarkeitZellRaster})

\textbf{Vorverarbeitung:}

\begin{itemize}
\item Bestimme eine \emph{Bounding Box} $Q$ der Szene
  (achsenparalleler Quader, der alle Objekte $Oâ‚–$ â€“
  einschlieÃŸlich Lichtquellen â€“ enthÃ¤lt).

\item Unterteile $Q$ in $\mdef{râ‚“ Ã— r_y Ã— r_z}$
  Zellen $Q_{xyz}$ (Quader \emph{gleicher GrÃ¶ÃŸe}).

\item Bestimme fÃ¼r jedes Objekt $Oâ‚–$ die vom Objekt berÃ¼hrten
  Zellen (â‰™ \emph{3D Scan Conversion}) und trage
  $Oâ‚–$ in die entsprechenden Listen $L_{xyz}$ ein.
\end{itemize}

\textbf{eigentliche Strahlverfolgung:}

\begin{itemize}
\item Bestimme der Reihe nach die vom Strahl berÃ¼hrten Zellen
  (â‰™ \emph{inkrementelle 3D Scan Conversion}).

\item FÃ¼hre fÃ¼r jede solche Zelle $Q_{xyz}$ Schnitttests mit den
  Objekten in $L_{xyz}$ durch.

  \cmt{\evtl nur fÃ¼r die Objekte, die nicht schon in anderen
    Zellen geprÃ¼ft wurden}
\end{itemize}
\Reached{WS17/18}{10}{2017/12/14}

\pagebreak

\textbf{Beispiel (2D):}

\begin{center}
  \scalebox{0.5}{\huge\input{fig_farbeRaytracingZellen}}%â‚â‚‚â‚ƒâ‚„â‚…
\end{center}

\pagebreak

\vspace*{-25mm}
\begin{Hide}
  \begin{center}
    \begin{tabular}{L|L|L|L}
      \multicolumn{1}{l|}{durchlaufene Zellen $Q_{xy}$} & L_{xy} &
      \multicolumn{1}{l|}{Schnitttests mit} & \multicolumn{1}{l}{Schnittpunkte} \\ \hline
      Qâ‚‚â‚ & âˆ… && \\
      Qâ‚‚â‚‚ & Oâ‚ & Oâ‚ & \\
      Qâ‚ƒâ‚‚ & Oâ‚ƒ & Oâ‚ƒ & \\
      Qâ‚ƒâ‚ƒ & Oâ‚‚, Oâ‚ƒ & Oâ‚‚ & \point{S}â‚‚^{\mymagenta{*}} \\
      Qâ‚ƒâ‚„ & Oâ‚‚, Oâ‚„ & Oâ‚„ & \point{S}â‚„^{\mymagenta{*}} \\
      Qâ‚„â‚„ & Oâ‚‚, Oâ‚ƒ, Oâ‚„ &&
    \end{tabular}

    \mymagenta{${}^*$: bisher nÃ¤chstgelegener Schnittpunkt}
  \end{center}
\end{Hide}
\Reached{WS14/15}{09}{2014/12/04}

\vspace*{-1mm}
\minisec{Octree-Unterteilung}
\index{Octree}

\begin{description}
\item[Idee:] FÃ¼hre die Unterteilung \emph{adaptiv} durch, \dH unterteile dort
  feiner, wo sich viele (kleine) Objekte befinden.
\end{description}

\textbf{Vorverarbeitung:}

\begin{itemize}
\item Bestimme eine Bounding Box $Q_{âˆ™âˆ™âˆ™}$ der Szene und setze
  $L_{âˆ™âˆ™âˆ™} := \mk{\text{alle Objekte (einschl.\ Lichtquellen)}}$.

\item Solange es noch einen Quader $Q_{xyz}$ gibt, der â€groÃŸ genugâ€œ
  ist und â€zu vieleâ€œ Objekte enthÃ¤lt,

  \qquad zerlege $Q_{xyz}$ in \emph{acht} Quader $Q_{x' y' z'}$,

  \qquad bestimme fÃ¼r jeden dieser Teilquader die Menge
  $L_{x' y' z'} := \set{Oâ‚– âˆˆ L_{xyz}}{Oâ‚– \text{ trifft } Q_{x' y' z'}}$.
\end{itemize}

\textbf{eigentliche Strahlverfolgung:}

\begin{itemize}
\item Ã¤hnlich wie bei der Zellraster-Unterteilung (mit modifizierter
  Scan Conversion)
\end{itemize}

\textbf{Beispiel (2D):}

\begin{center}
  \scalebox{0.5}{\huge\input{fig_farbeRaytracingOctree}}%â‚â‚‚â‚ƒâ‚„â‚…âˆ™
\end{center}

\pagebreak

Kriterien fÃ¼r die Unterteilung in diesem Beispiel:
\begin{itemize}
\item â€zu vieleâ€œ Objekte: mehr als eines
\item â€groÃŸ genugâ€œ: in jeder Koordinatenrichtung in hÃ¶chstens
  acht gleiche Teile zerlegen
\end{itemize}

zugehÃ¶riger \emph{Quadtree}\index{Quadtree}:

\begin{center}
  % \scalebox{0.39}{\huge\selectinput{fig_farbeRaytracingOctreeBaum}{leer}}%â‚â‚‚â‚ƒâ‚„â‚…âˆ™âˆ…
  \scalebox{0.39}{\huge\input{fig_farbeRaytracingOctreeBaum}}%â‚â‚‚â‚ƒâ‚„â‚…âˆ™âˆ…
\end{center}

\pagebreak

% \begin{Hide}
\begin{center}
  \begin{tabular}{L|L|L|L}
    \multicolumn{1}{l|}{durchlaufene Zellen $Q_{xy}$} & L_{xy} &
    \multicolumn{1}{l|}{Schnitttests mit} & \multicolumn{1}{l}{Schnittpunkte} \\ \hline
    Q_{01,00} & Oâ‚… & Oâ‚… & \\
    Q_{010,010} & Oâ‚ & Oâ‚ & \\
    Q_{010,011} & Oâ‚ && \\
    Q_{011,011} & Oâ‚ƒ & Oâ‚ƒ & \\
    Q_{011,100} & Oâ‚ƒ && \\
    Q_{011,101} & Oâ‚‚ & Oâ‚‚ & \point{S}â‚‚^{\mymagenta{*}} \\
    Q_{100,101} & Oâ‚ƒ, Oâ‚„ & Oâ‚„ & \point{S}â‚„^{\mymagenta{*}} \\
    Q_{100,110} & Oâ‚‚, Oâ‚„ &&
  \end{tabular}

  \mymagenta{${}^*$: bisher nÃ¤chstgelegener Schnittpunkt}
\end{center}
% \end{Hide}

\begin{bemerkung}
  Die Strahlverfolgung springt \iA zwischen verschiedenen Niveaus des
  Octrees hin und her (Strahl lÃ¤uft durch unterschiedlich groÃŸe
  Zellen).
\end{bemerkung}

\pagebreak

\minisec{Median-Unterteilung}

\begin{description}
\item[Idee:] Versuche so zu unterteilen, dass die Teilgebiete (etwa) gleich
  viele Objekte treffen (aber kein â€NormmaÃŸâ€œ mehr besitzen).

  Unterteile zuerst in $x$-Richtung, dann jede der beiden
  â€HÃ¤lftenâ€œ (wenn nÃ¶tig) in $y$-Richtung, dann die
  â€Viertelâ€œ in $z$-Richtung, dann wieder in $x$-Richtung, \usw
\end{description}

\textbf{Vorverarbeitung:}

\begin{itemize}
\item Bestimme eine Bounding Box $Q_{âˆ™âˆ™âˆ™}$ der Szene und setze
  $L_{âˆ™âˆ™âˆ™} := \mk{\text{alle Objekte (einschl.\ Lichtquellen)}}$.

\item Solange es noch einen Quader $Q_{xyz}$ gibt, der
  â€groÃŸ genugâ€œ ist und â€zu vieleâ€œ Objekte enthÃ¤lt,

  \qquad zerlege $Q_{xyz}$ in der â€nÃ¤chstenâ€œ Richtung in
  \emph{zwei} Quader $Q_{x' y' z'}$,

  \qquad bestimme fÃ¼r jeden dieser Teilquader die Menge
  $L_{x' y' z'}$.
\end{itemize}

\pagebreak

\vspace*{-19mm}
\textbf{Beispiel (2D):}

\vspace*{-14mm}
\begin{center}
  \scalebox{0.5}{\huge\input{fig_farbeRaytracingMedian}}%â‚â‚‚â‚ƒâ‚„â‚…
\end{center}
\Reached{WS15/16}{09}{2016/01/07}

\begin{center}
  % \begin{Hide}
  \begin{tabular}{L|L|L|L}
    \multicolumn{1}{l|}{durchlaufene Zellen $Q_{xy}$} & L_{xy} &
    \multicolumn{1}{l|}{Schnitttests mit} & \multicolumn{1}{l}{Schnittpunkte} \\ \hline
    [-0,5; 3,0] Ã— [-2,5; 0,5] & Oâ‚ & Oâ‚ & \\{}
    [-2,0; 3,0] Ã— [0,5; 5,0] & Oâ‚‚ & Oâ‚‚ & \point{S}â‚‚^{\mymagenta{*}} \\{}
    [3,0; 6,75] Ã— [-1,0; 2,25] & Oâ‚ƒ & Oâ‚ƒ & \\{}
    [3,0; 5,5] Ã— [2,25; 3,75] & Oâ‚‚, Oâ‚„ & Oâ‚„ & \point{S}â‚„^{\mymagenta{*}}
  \end{tabular}

  \mymagenta{${}^*$: bisher nÃ¤chstgelegener Schnittpunkt}
  % \end{Hide}
\end{center}

\pagebreak

zugehÃ¶riger \emph{BSP-Baum\index{BSP-Baum} (Binary Space
  Partitioning\index{Binary Space Partitioning})}:

% \begin{Hide}
\begin{center}
  % \resizebox{!}{94mm}{\huge\selectinput{fig_farbeRaytracingMedianBaum}{leer}}%â‚â‚‚â‚ƒâ‚„â‚…â‰¤
  \resizebox{!}{94mm}{\huge\input{fig_farbeRaytracingMedianBaum}}%â‚â‚‚â‚ƒâ‚„â‚…â‰¤
\end{center}
% \end{Hide}

\textbf{eigentliche Strahlverfolgung:}

\begin{itemize}
\item Lokalisiere den Ausgangspunkt des Strahls im BSP-Baum.

\item Bestimme, durch welche FlÃ¤che der Strahl die aktuelle Zelle
  verlÃ¤sst, berechne einen Punkt $\widetilde{\point{P}}$
  â€knapp jenseitsâ€œ dieser FlÃ¤che und lokalisiere
  $\widetilde{\point{P}}$ im BSP-Baum.

  \begin{itemize}
  \item[â‡] nÃ¤chste vom Strahl durchlaufene Zelle
  \end{itemize}
\end{itemize}
\Reached{WS16/17}{11}{2017/01/12}

\minisec{Bemerkungen zu allen drei Unterteilungsstrategien}

\begin{itemize}
\item Dass ein Objekt mehrfach gegenÃ¼ber demselben Strahl getestet
  wird (da es zu mehreren $Láµ¢$ gehÃ¶rt), lÃ¤sst sich
  beispielsweise so verhindern:
  \begin{itemize}
  \item Ordne jedem untersuchten Strahl eine eindeutige
    (\zB fortlaufende) Nummer zu.
  \item Trage nach dem Schnitttest â€Objekt $Oâ‚–$ â€“ Strahl $j$â€œ die Nummer $j$ bei Objekt $Oâ‚–$ ein.
  \item PrÃ¼fe vor jedem Test â€$Oâ‚–$ â€“ $j$â€œ, ob $Oâ‚–$
    bereits mit â€$j$â€œ markiert ist.
  \end{itemize}

\item Die Schnitttests dÃ¼rfen nicht abgebrochen werden, sobald der
  erste Schnittpunkt gefunden ist.
  Man muss bis zu der Zelle laufen, die den (unter den bereits
  bestimmten) nÃ¤chstgelegenen Schnittpunkt enthÃ¤lt, und deren
  Objekte noch prÃ¼fen.

\item In der Vorverarbeitung kann man $Oâ‚–$ auch in alle Zellen
  aufnehmen, die von der \emph{Bounding Box} von $Oâ‚–$ getroffen
  werden (nicht unbedingt vom Objekt).

  \begin{itemize}
  \item[â‡’] Vorverarbeitung \iA wesentlich einfacher,

    dafÃ¼r spÃ¤ter mehr Ã¼berflÃ¼ssige Schnitttests
  \end{itemize}
\end{itemize}

\pagebreak

\minisec{Vergleich der Unterteilungsstrategien}

\textbf{Zellraster:}

\begin{itemize}
\item[\Good] Die Listen $L_{xyz}$ kÃ¶nnen sehr effizient bestimmt
  werden.

\item[\Good] Die vom Strahl durchlaufenen Zellen kÃ¶nnen sehr einfach
  (und schnell) generiert und zugegriffen werden.

\item[\Bad] benÃ¶tigt meist wesentlich mehr Zellen als die adaptiven
  Strategien
  \begin{itemize}
  \item Speicherplatz
  \item Bei der Strahlverfolgung mÃ¼ssen viele Zellen durchlaufen
    werden.
  \end{itemize}

\item[\Bad] Die $L_{xyz}$ kÃ¶nnen noch sehr umfangreich sein.

\item[â‡’] geeignet fÃ¼r Szenen mit relativ kleinen, etwa
  gleichmÃ¤ÃŸig verteilten Objekten
\end{itemize}

\textbf{Octree:}

\begin{itemize}
\item[\Good] Vorverarbeitung und Strahlverfolgung relativ einfach

\item[\Good] moderate Anzahl von Zellen und einigermaÃŸen
  ausgeglichene Verteilung der Objekte auf die Zellen

\item[\Bad] Der Octree kann sehr unbalanciert werden.
  \begin{itemize}
  \item[â‡’] Zellengenerierung bei Strahlverfolgung wird
    langsamer
  \end{itemize}

\item[â‡’] universell verwendbar, aber nicht immer optimal
\end{itemize}

\textbf{Median-Unterteilung:}

\begin{itemize}
\item[\Good] liefert oft gut balancierte BÃ¤ume mit wenigen Zellen

\item[\Bad] Vorverarbeitung und Strahlverfolgung werden komplexer

  (Wo muss der Quader unterteilt werden?)

\item[â‡’] geeignet fÃ¼r Szenen mit â€Ballungenâ€œ kleiner
  Objekte
\end{itemize}
\Reached{WS18/19}{10}{2018/12/20}


\subsection{Beschleunigung der Strahlverfolgung (II)}

\begin{description}
\item[Beobachtung:] Die meisten der zu verfolgenden Strahlen gehen von wenigen festen
  Punkten (den $m$ \emph{Lichtquellen}) aus.

  \begin{itemize}
  \item[â‡’] Versuche, die Tests â€liegt auf dem Strahl
    von $Lâ‚—$ nach $\point{P}'$ ein anderes Objekt?â€œ
    mÃ¶glichst effizient zu machen.

  \item[â‡’] Sammle in einer \emph{Vorverarbeitung} Information
    Ã¼ber die Lage der Objekte \bzgl der Lichtquellen.
  \end{itemize}

  \pagebreak

\item[Ansatz:]
  \emph{Lichtpuffer}\index{Lichtpuffer bei Raytracing}\index{Raytracing!Lichtpuffer}

  \begin{center}
    \scalebox{0.475}{\huge\input{fig_farbeRaytracingLichtpuffer}}%â‚—â‚â‚‚â‚ƒâ‚„â‚…â‚†â‚‡â‚ˆâ‚‰
  \end{center}
\end{description}

\minisec{Vorverarbeitung}

\begin{AlgListInline}
  fÃ¼r jede Lichtquelle $Lâ‚—$
  Â°Â°Â°lege einen WÃ¼rfel um $Lâ‚—$ und unterteile dessen SeitenflÃ¤chen in Zellen $Z_{l,i}$
  Â°Â°Â°bestimme fÃ¼r jede Zelle $Z_{l,i}$, welche Objekte (teilweise) in das durch $Lâ‚—$ und $Z_{l,i}$ definierte
  Â°Â°Â°Â°Â°Â°Â°Â°Volumen fallen, und speichere diese in einer Liste $L_{l,i}$
  Â°Â°Â°Â°Â°Â°Â°Â°(soweit mÃ¶glich, bereits nach der Entfernung von $Lâ‚—$ geordnet)
  Â°Â°Â°/* praktische Realisierung: FÃ¼hre fÃ¼r jedes Objekt $Oâ‚–$ Projektion auf den WÃ¼rfel und Scan
  Â°Â°Â°Â°Â°Â°Conversion bzgl. der â€Zellen-Pixmapsâ€œ durch */
\end{AlgListInline}

\minisec{Eigentliche Strahlverfolgung}

\begin{AlgListInline}
  projiziere $\point{P}'$ auf den WÃ¼rfel und bestimme die Zelle $Z_{l,i}$, in welche der Punkt fÃ¤llt
  fÃ¼r alle Objekte $Oâ‚–$ in $L_{l,i}$
  Â°Â°Â°prÃ¼fe, ob der Strahl das Objekt zwischen $Lâ‚—$ und $\point{P}'$ schneidet
  Â°Â°Â°/* Wenn dies der Fall und $Oâ‚–$ undurchsichtig ist, dann kÃ¶nnen die Schnitttests abgebrochen
  Â°Â°Â°Â°Â°Â°werden */
\end{AlgListInline}

\pagebreak

\begin{description}
\item[Beobachtung:] \mbox{}

  \begin{center}
    \scalebox{0.6}{\LARGE\input{fig_farbeRaytracingAdaptiv1}}
  \end{center}

  \pagebreak

  Die wahrgenommene IntensitÃ¤t kann sich beispielsweise
  zusammensetzen aus:

  \begin{center}
    \scalebox{0.45}{\huge\input{fig_farbeRaytracingAdaptiv2}}
  \end{center}

  \begin{itemize}
  \item[â‡’] $I_{BSS}$ geht nur mit dem Faktor
    $0,1 Â· 0,3 Â· 0,2 = 0,006$ in $I$ ein.

  \item[â‡’] $I_{BSS}$ kann vernachlÃ¤ssigt werden, \emph{wenn}
    die GesamtintensitÃ¤t $I$ â€nicht zu kleinâ€œ ist.
  \end{itemize}

\item[Ansatz:] \emph{adaptive Tiefenkontrolle}%
  \index{adaptive Tiefenkontrolle bei Raytracing}\index{Raytracing!adaptive Tiefenkontrolle}

  \begin{itemize}
  \item FÃ¼hre bei jedem rekursiven Aufruf der Strahlverfolgung
    zwei zusÃ¤tzliche Parameter mit:

    \begin{itemize}
    \item den Faktor $f$, mit dem die IntensitÃ¤t des gerade
      verfolgten Strahls in die GesamtintensitÃ¤t $I$
      eingeht

    \item die bisher akkumulierte GesamtintensitÃ¤t $I$
    \end{itemize}

  \item Wenn $f â‰ª I$, dann muss der Strahl nicht verfolgt
    werden.
  \end{itemize}
\end{description}

\begin{bemerkungen} \mbox{}
  \begin{enumerate}
  \item Um $I$ mÃ¶glichst schnell wachsen zu lassen, sollte man die
    â€BeitrÃ¤geâ€œ in geeigneter Reihenfolge betrachten:

    \begin{itemize}
    \item zuerst ambienter Anteil

      (benÃ¶tigt keine Strahlverfolgung)

    \item dann BeitrÃ¤ge direkt von den Lichtquellen

      (Strahlverfolgung besonders effizient und rekursionsfrei)

    \item dann gespiegelter oder gebrochener Anteil (je nachdem,
      welcher der Koeffizienten $R_S$ oder $R_B$ grÃ¶ÃŸer
      ist)
    \end{itemize}

  \item Die â€effektivâ€œ zu verfolgende Tiefe fÃ¼r ein
    einigermaÃŸen realistisches Bild liegt bei etwa
    $t_{\mathtxtrm{eff}}$ â‰ˆ 1,7 â€“ 2,0
    (weitgehend unabhÃ¤ngig von $t_{\max}$).

    EnthÃ¤lt die Szene sehr viele stark spiegelnde und/oder
    brechende Objekte (\zB Glas), so kann $t_{\mathtxtrm{eff}}$ auch
    deutlich grÃ¶ÃŸer sein.
  \end{enumerate}
\end{bemerkungen}

\pagebreak

\begin{description}
\item[Beobachtung:] Wenn die â€effektiveâ€œ Tiefe klein ist, geht ein groÃŸer Teil
  aller zu verfolgenden Strahlen vom Augenpunkt aus.

  \begin{itemize}
  \item[â‡’] Versuche, die zuerst getroffenen Objekte
    mÃ¶glichst effizient zu bestimmen.
  \end{itemize}

\item[Idee:] Strahlverfolgung vom Auge aus entspricht
  \emph{Visible Surface Ray Tracing}

  verwende statt dessen \emph{$\mathbf{z}$-Puffer}-Ansatz zur Bestimmung der
  sichtbaren (= zuerst erreichten) Objekte
\end{description}

\minisec{Vorverarbeitung}

\begin{AlgListInline}
  bestimme mit einem modifizierten $z$-Puffer-ÂºAlgorithmusÂº die Entfernung $z_{i,j}$ des bei jedem Pixel $(i, j)$
  Â°Â°Â°Â°Â°sichtbaren Objekts $O_{k_{i,j}}$
  // Die $k_{i,j}$ werden im sog. @\emph{Objektpuffer}@ gespeichert.
\end{AlgListInline}%
\index{Objektpuffer bei Raytracing}\index{Raytracing!Objektpuffer}

\minisec{Eigentliche Bilderzeugung}

\begin{AlgListInline}
  fÃ¼r jedes Pixel $(i, j)$
  Â°Â°Â°wenn $k_{i,j}$ = Âºâ€ÂºHintergrundÂºâ€œÂº
  Â°Â°Â°Â°Â°Â°fÃ¤rbe das Pixel mit der Hintergrundfarbe
  Â°Â°Â°sonst
  Â°Â°Â°Â°Â°Â°bestimme den Schnittpunkt $\point{P}'$ des Âºâ€ÂºSehstrahlsÂºâ€œÂº mit $O_{k_{i,j}}$
  Â°Â°Â°Â°Â°Â°fÃ¤rbe Pixel $(i, j)$ gemÃ¤ÃŸ der von $\point{P}'$ einfallenden IntensitÃ¤t
  Â°Â°Â°Â°Â°Â°// â‰™ Raytracing ohne die erste Strahlverfolgung
\end{AlgListInline}


\subsection{Selektives Raytracing}

\begin{description}
\item[Motivation:] Bei â€nicht allzu kÃ¼nstlichenâ€œ Szenen werden die
  durch Raytracing simulierten Effekte (Spiegelungen, \usw) nur an
  wenigen Stellen des Bildes sichtbar sein.

  \begin{itemize}
  \item[â‡’] Versuche, den Aufwand fÃ¼r Raytracing an den
    â€harmlosenâ€œ Stellen des Bildes zu sparen.
  \end{itemize}

\item[Ansatz:] \mbox{}

  \begin{itemize}
  \item Erzeuge zunÃ¤chst mit einem â€Standard-Verfahrenâ€œ
    (\zB $z$-Puffer-Algorithmus mit Phong-Shading) ein
    \emph{â€rohes Bildâ€œ}.

    FÃ¼hre dabei einen \emph{Objektpuffer} mit.

  \item \emph{â€Nachbesserungâ€œ}:


    \begin{AlgListInline}
      fÃ¼r alle Pixel $(i, j)$
      Â°Â°Â°wenn das beim Pixel $(i, j)$ sichtbare Objekt $O_{k_{i,j}}$ spiegelt, durchsichtig ist o.@\,@Ã¤.
      Â°Â°Â°Â°Â°Â°berechne die FÃ¤rbung des Pixels mit Raytracing
    \end{AlgListInline}
  \end{itemize}
\end{description}

\pagebreak


\subsection{Bemerkungen}

\begin{itemize}
\item Trotz aller Optimierungen sind immer sehr viele Schnitttests
  notwendig â€“ typisch: $ğ’ª\fk{10â¸}$

  \begin{itemize}
  \item[â‡’] durch geeignete \emph{Vorverarbeitung der Objekte}
    diese Schnitttests (vor allem die erfolglosen!) mÃ¶glichst
    schnell machen:

    \begin{itemize}
    \item Bounding Box, â€¦
    \end{itemize}
  \end{itemize}

\item Die lokale IntensitÃ¤tsberechnung kann leicht erweitert werden:

  \begin{itemize}
  \item Textur

  \item bessere Simulation der diffusen/winkelabhÃ¤ngigen
    Reflexion
    (Mikrofacetten-Modell, â€¦)

  \item â€¦
  \end{itemize}
\end{itemize}
\Reached{WS17/18}{11}{2017/12/21}
\ReachedZoom{WS20/21}{10}{2021/01/14}
\Reached{WS21/22}{10}{2021/12/16}

\pagebreak


\section{Radiosity-Verfahren}

\vspace*{-3mm}
(nach Goral/Torrance/Greenberg/Battaile 1984)

\begin{description}
\item[Ziel:] mÃ¶glichst gute Nachbildung der Effekte (mehrmaliger) diffuser Reflexion
\end{description}
\personHidden{-5mm}{Cindy M.~Goral}{}{}{}{person_Goral}{}%
{\urlpers{https://www.linkedin.com/in/goral}}{}%

\personHidden{-15mm}{Kenneth E.~Torrance}{}{2010}{}{person_Torrance}{}%
{\urlpers{http://www.legacy.com/obituaries/theithacajournal/obituary.aspx?n=kenneth-e-torrance&pid=139745916}}%
{}%

\personHidden{-25mm}{Donald Peter Greenberg}%
{1934}{}{}%
{person_Greenberg}{}{\urlpers{https://aap.cornell.edu/people/donald-greenberg}}{}%

\personHidden{-35mm}{Bennett Battaile}{}{}{}%
{person_Battaile}{}%
{\urlpers{http://pnca.edu/faculty/meet/bbattaile}}{}%

\pagebreak

\begin{beispiele} \mbox{}
  \begin{enumerate}
  \item \emph{â€Farbverschiebungâ€œ}\index{Farbverschiebung durch diffuse Reflexion}%
    \index{diffuse Reflexion!Farbverschiebung}

    \begin{center}
      \scalebox{0.5}{\huge\input{fig_farbeRadiosityFarbverschiebung}}
    \end{center}

    \begin{itemize}
    \item[â‡’] Alle Objekte im Raum erhalten einen â€Rotstichâ€œ.
    \end{itemize}

  \item \emph{â€Colour Bleedingâ€œ}\index{Colour Bleeding bei diffuser Reflexion}%
    \index{diffuse Reflexion!Colour Bleeding}

    \begin{center}
      \scalebox{0.5}{\huge\input{fig_farbeRadiosityColourBleeding}}
    \end{center}

    \begin{itemize}
    \item[â‡’] rote Farbe â€lÃ¤uftâ€œ auch auf die weiÃŸe FlÃ¤che Ã¼ber
    \end{itemize}
  \end{enumerate}
\end{beispiele}

\pagebreak

\begin{description}
\item[Ansatz:] (Diffuse) Reflexion ist ein \emph{Energie}austausch zwischen den
  Objekten.

  \begin{itemize}
  \item[â‡’] Ãœbertrage ein Modell fÃ¼r den WÃ¤rmeaustausch
    auf den Austausch von Licht.
  \end{itemize}

\item[vereinfachende Annahmen:] \mbox{}

  \begin{itemize}
  \item Die Szene bildet ein \emph{geschlossenes System im Gleichgewicht}, \dH:

    \begin{itemize}
    \item Die gesamte von einem Objekt abgestrahlte
      (emittierte oder reflektierte) Energie wird von den
      Objekten der Szene absorbiert oder weiter reflektiert
      (kein Energietransport â€nach auÃŸenâ€œ).

    \item Der Energieaustausch variiert nicht mit der Zeit.
    \end{itemize}

  \item Die Objekte sind \emph{vollkommen diffuse} Strahler
    \bzw Reflektoren, \dH sie erscheinen aus jeder Richtung
    â€gleich hellâ€œ.

    \begin{center}
      \scalebox{0.5}{\huge\input{fig_farbeRadiosityVollkommenDiffus}}
    \end{center}
  \end{itemize}
\end{description}
\Reached{WS14/15}{10}{2014/12/11}
\Reached{WS19/20}{11}{2019/12/19}

\pagebreak


\subsection{Raumwinkel}

\begin{description}
\item[\emph{Raumwinkel\index{Raumwinkel} (Solid Angle\index{Solid Angle}):}]
  der von einem Punkt $\point{P}$ aus durch eine FlÃ¤che $A$
  Ã¼berdeckte Winkelbereich

\item[Einheit:] \emph{sr\index{sr, Steradiant} (Steradiant\index{Steradiant})}: 1\,sr ist der zu
  einer FlÃ¤che 1 auf der Einheitskugel gehÃ¶rende Raumwinkel.

  \begin{center}
    \scalebox{0.6}{\LARGE\input{fig_farbeRadiosityRaumwinkel1}}%Ï‰
  \end{center}
\end{description}

\begin{beispiel}
  Die gesamte Einheitskugel besitzt die OberflÃ¤che $4 Ï€$.

  \begin{itemize}
  \item[â‡’] Sie verdeckt (vom Mittelpunkt aus) den Raumwinkel
    $Ï‰ = 4 Ï€ \, \text{[sr]}$.
  \end{itemize}
\end{beispiel}

\pagebreak

\begin{bemerkung}\label{bem:verkuerzteFlaeche}
  Von $\point{P}$ aus ist statt $\dd A$ nur die â€verkÃ¼rzteâ€œ
  FlÃ¤che $\dd A Â· \cos Ï†$ sichtbar.

  \cmt{$Ï†$: Winkel zwischen Normale $\vektor{n}$ zu $\dd A$ und
    Projektionsrichtung $\overrightarrow{\dd A \point{P}}$}

  \begin{center}
    \scalebox{0.6}{\LARGE\input{fig_farbeRadiosityRaumwinkel2}}%Ï†Ï‰
  \end{center}

  \begin{itemize}
  \item[â‡’] \quad
    $\displaystyle \dd Ï‰ = \frac{\cos Ï†}{rÂ²} \dd A$
  \end{itemize}

  Damit verdeckt $A$ von $\point{P}$ aus den Raumwinkel
  \[ Ï‰ = âˆ«_A \frac{\cos Ï†}{rÂ²} \, \dd A
    \qquad
    \text{\cmt{$Ï†$ und $r$ hÃ¤ngen von $\dd A$ ab!}} \]
  (falls $A$ sich nicht teilweise selbst verdeckt).
\end{bemerkung}


\subsection{Radiosity}%
\label{subsec:radiosity}

\begin{description}
\item[\emph{Radiosity:}\index{Radiosity}] die von einem Objekt pro Zeit- und
  \emph{sichtbarer} FlÃ¤cheneinheit
  abgestrahlte Energie
  $\displaystyle{\ek{\frac{\text{W}}{\text{mÂ²}}}}$

\item[Radiance (Strahldichte):] die von einem Objekt pro Zeit- und
  sichtbarer FlÃ¤cheneinheit in eine bestimmte Richtung
  abgestrahlte Energie pro Steradiant
  $\displaystyle{\ek{\frac{\text{W}}{\text{mÂ²} Â· \text{sr}}}}$
\end{description}

\begin{bemerkungen} \mbox{}
  \begin{enumerate}
  \item Da das Objekt vÃ¶llig diffus abstrahlt, ist die Radiosity
    unabhÃ¤ngig von der Richtung.

  \item Wegen der Gleichgewichtsannahme kann man Leistung
    $[\text{W}]$ und Energie $[\text{J}]$ gleichwertig
    verwenden.
  \end{enumerate}
\end{bemerkungen}

\begin{beispiel}
  Wie viel Energie strahlt eine FlÃ¤che $\dd A$ der Radiosity $B$
  insgesamt (pro Zeiteinheit) ab?

  \begin{center}
    \scalebox{0.5}{\huge\input{fig_farbeRadiosityEnergie}}%Ï†
  \end{center}

  \pagebreak

  \vspace*{-22mm}
  Von einem Punkt $\point{P}$ auf der Einheitskugel aus ist statt $\dd A$
  nur die â€verkÃ¼rzteâ€œ FlÃ¤che $\dd A Â· \cos Ï†$ sichtbar.

  Die gesamte Strahlung von $\dd A$ in Richtung $\point{P}$ ist also
  \[ B Â· \dd A Â· \cos Ï† \,\text. \]

  Die Punkte mit gleichem $Ï†$ Ã¼berdecken auf der Einheitskugel
  die FlÃ¤che
  \[ 2Ï€ \underbrace{\sin Ï†}_{\parbox[t]{2.5cm}{\small Radius des \\ â€Streifensâ€œ}}
    Â· \underbrace{\dd Ï†}_{\parbox[t]{2.5cm}{\small Breite des \\ â€Streifensâ€œ}}
    = \underbrace{\dd Ï‰}_{\parbox[t]{2.5cm}{\small Ã¼berdeckter \\ Raumwinkel}} \,\text. \]

  Sie erhalten also die Leistung
  \[ B Â· \dd A Â· \cos Ï† Â· 2Ï€ \sin Ï† Â· \dd Ï† \,\text. \]

  \enlargethispage{5mm}
  Also gibt $\dd A$ insgesamt die Leistung
  \begin{align}
    E_{\dd A} &= âˆ«â‚€^{\frac{Ï€}{2}} B Â· \dd A Â· \cos Ï† Â· 2Ï€ \sin Ï† Â· \dd Ï† \nonumber \\
    &= 2Ï€ B \dd A âˆ«â‚€^{\frac{Ï€}{2}} \cos Ï† \sin Ï† \, \dd Ï† \nonumber \\
    &= 2Ï€ B \dd A Â· \left. \frac12 \sinÂ² Ï† \right|â‚€^{\frac{Ï€}{2}} \nonumber \\
    &= Ï€ B \dd A \label{eq:radiosityEdA}
  \end{align}
  ab (auf eine Halbkugel Ã¼ber $\dd A$ verteilt).
\end{beispiel}

\pagebreak


\subsection{Von den Objekten zum Gleichungssystem}

\begin{description}
\item[Ansatz:] \mbox{}
  \[ \underbrace{\text{abgestrahlte
        Energie}^{\mymagenta{*}}}_{\text{\small Radiosity }
      Â· \text{ \small FlÃ¤che}}
    = \underbrace{\text{emittierte
        Energie}^{\mymagenta{*}}}_{\parbox{3.2cm}{\small Emission pro \\
        FlÃ¤cheneinheit } Â· \text{ \small FlÃ¤che}}
    + \underbrace{\text{reflektierte
        Energie}^{\mymagenta{*}}}_{\parbox{2.5cm}{\small
        Reflexions\-koeffizient } Â· \: \parbox{5cm}{ \small von allen
        Objekten \\ einfallende
        Energie${}^{\mymagenta{*}}$}} \]
  \mymagenta{${}^*$:
    pro Zeiteinheit
    $\displaystyle{\ek{\text{W}}}$}
\end{description}

\begin{equation}
  \label{eq:radiosityKontinuierlich}
  Báµ¢ Â· \dd Aáµ¢ = Eáµ¢ Â· \dd Aáµ¢ + Ïáµ¢ Â· âˆ«_Î© Bâ±¼ Â· F_{\dd Aâ±¼, \dd Aáµ¢} Â· \dd Aâ±¼
\end{equation}

\begin{tabular}{ll}
  $\dd Aáµ¢$: & betrachtete FlÃ¤che \\
  $Báµ¢$: & Radiosity der FlÃ¤che $\dd Aáµ¢$
  $\ek{\frac{\text{W}}{\text{mÂ²}}}$ \\
  $Eáµ¢$: & Eigenemission der FlÃ¤che $\dd Aáµ¢$
  $\ek{\frac{\text{W}}{\text{mÂ²}}}$ \\
  $Ïáµ¢$: & Reflexionskoeffizient der FlÃ¤che $\dd Aáµ¢$
  (welcher Anteil des einfallenden Lichts wird reflektiert?) \\
  $\dd Aâ±¼$: & irgendeine FlÃ¤che auf irgendeinem Objekt \\
  $Bâ±¼$: & Radiosity der FlÃ¤che $\dd Aâ±¼$ \\
  $Î©$: & gesamte FlÃ¤che aller Objekte \\
  $F_{\dd Aâ±¼, \dd Aáµ¢}$: & \emph{Formfaktor}\index{Formfaktor} (der
  Anteil der von $\dd Aâ±¼$ insgesamt
  abgestrahlten Energie $[\text{W}]$, der bei $\dd Aáµ¢$ ankommt)
\end{tabular}

\pagebreak

\begin{bemerkung}
  In den $F_{\dd Aâ±¼, \dd Aáµ¢}$ steckt die â€Geometrieâ€œ der Szene:
  \begin{itemize}
  \item Entfernung der FlÃ¤chen $\dd Aáµ¢$ und $\dd Aâ±¼$
  \item ihre relative Orientierung
  \item die Sichtbarkeit (Liegt ein Objekt dazwischen?)
  \end{itemize}
\end{bemerkung}

\begin{description}
\item[Problem:] In der kontinuierlichen
  Formulierung \eqref{eq:radiosityKontinuierlich}
  kann der Lichtaustausch nicht (mit dem Computer) berechnet werden.

\item[\textmd{â‡’} \emph{Diskretisierung}:] Zerlege die Objekte in insgesamt $\mdef{n}$
  FlÃ¤chenstÃ¼cke \emph{(Patches)}\index{Patch bei Radiosity}\index{Radiosity!Patch}
  $Aáµ¢$.
  FÃ¼r jeden Patch werden
  \begin{itemize}
  \item Radiosity $Báµ¢$,
  \item Eigenemission $Eáµ¢$ und
  \item Reflexionskoeffizient $Ïáµ¢$
  \end{itemize}
  als konstant angesetzt.
\end{description}

\pagebreak

\vspace*{-16mm}
Dies fÃ¼hrt auf
\begin{equation}
  \label{eq:radiosityDiskret}
  Báµ¢ Â· Aáµ¢ = Eáµ¢ Â· Aáµ¢ + Ïáµ¢ Â· âˆ‘â±¼â‚Œâ‚â¿ Bâ±¼ Â· Fâ±¼áµ¢ Â· Aâ±¼
\end{equation}
mit den \emph{Formfaktoren}\index{Formfaktor} $Fâ±¼áµ¢$.

\cmt{Welcher Anteil der von $Aâ±¼$ insgesamt abgestrahlten Energie
  erreicht $Aáµ¢$?}

In Abschnitt~\ref{subsec:faerbungFormfaktoren} wird die Beziehung
\begin{equation}
  Fâ±¼áµ¢ Â· Aâ±¼ = Fáµ¢â±¼ Â· Aáµ¢
  \label{eq:radiositySymmetrie}
\end{equation}
gezeigt.
Einsetzen in \eqref{eq:radiosityDiskret} und Division durch $Aáµ¢$
liefert
\[ Báµ¢ = Eáµ¢ + Ïáµ¢ Â· âˆ‘â±¼â‚Œâ‚â¿ Bâ±¼ Â· Fáµ¢â±¼ \]
\bzw
\[ \rk{1 - Ïáµ¢ Fáµ¢áµ¢} Â· Báµ¢ - âˆ‘_{jâ‰ i} Ïáµ¢ Â· Fáµ¢â±¼ Â· Bâ±¼ = Eáµ¢ \]
\bzw
\begin{equation}
  \label{eq:radiosityLGS}
  \mdef{\underbrace{\black{\pmat{1 - Ïâ‚ Fâ‚â‚ & -Ïâ‚ Fâ‚â‚‚ & â‹¯ & -Ïâ‚ Fâ‚â‚™ \\
          -Ïâ‚‚ Fâ‚‚â‚ & 1 - Ïâ‚‚ Fâ‚‚â‚‚ & â‹¯ & -Ïâ‚‚ Fâ‚‚â‚™ \\ â‹® & â‹® && â‹® \\
          -Ïâ‚™ Fâ‚™â‚ & -Ïâ‚™ Fâ‚™â‚‚ & â‹¯ & 1 - Ïâ‚™ Fâ‚™â‚™}}}_{\textstyle\text{\emph{Radiosity Matrix} } M_R}}
  Â· \pmat{Bâ‚ \\ Bâ‚‚ \\ â‹® \\ Bâ‚™}
  = \pmat{Eâ‚ \\ Eâ‚‚ \\ â‹® \\ Eâ‚™} \,\text.
\end{equation}\index{Radiosity Matrix}

\pagebreak

\pngpage[\imglic{Hugo Elias (myself)}%
{\urllic{https://commons.wikimedia.org/wiki/File:Radiosity_Comparison.jpg}}%
{â€Radiosity Comparisonâ€œ}
{\ccbysa~3.0, \urllic{https://creativecommons.org/licenses/by-sa/3.0/legalcode}}]{%
  Bilder/wikimedia/radiosity-comparison}

\pagebreak

\vspace*{-22mm}
\begin{bemerkungen} \mbox{}
  \begin{enumerate}
  \item $Ïáµ¢$ und $Eáµ¢$ sind \iA abhÃ¤ngig von der
    WellenlÃ¤nge $Î»$.

    \begin{itemize}
    \item[â‡’] FÃ¼r jede betrachtete WellenlÃ¤nge muss ein
      solches System gelÃ¶st werden.
    \end{itemize}

    ($Fáµ¢â±¼$ wird meist als $Î»$-unabhÃ¤ngig betrachtet.)

  \item $Fáµ¢áµ¢ = 0$, falls der zugehÃ¶rige Patch $Aáµ¢$ eben oder
    konvex ist,

    $Fáµ¢áµ¢ > 0$, falls $Aáµ¢$ konkav ist; dann fÃ¤llt ein Teil
    der abgestrahlten Energie wieder auf $Aáµ¢$.

    \begin{center}
      \scalebox{0.5}{\huge\input{fig_farbeRadiosityKonkav}}%áµ¢
    \end{center}

    \vspace*{-15mm}
  \item $\displaystyle{âˆ‘â±¼â‚Œâ‚â¿ Fáµ¢â±¼ = 1}$

    (wegen der Annahme, dass alles von $Aáµ¢$ abgestrahlte Licht
    wieder auf die Patches $Aâ±¼$ fÃ¤llt)

  \item $Fáµ¢â±¼ = 0$, wenn $Aâ±¼$ von $Aáµ¢$ aus unsichtbar
    (verdeckt) ist.

    \begin{itemize}
    \item[â‡’] Die Radiosity Matrix ist meist \emph{dÃ¼nn besetzt}

      (typisch: ca.\ 10\,\% der $Fáµ¢â±¼$ sind $â‰  0$).
    \end{itemize}

    Die Matrix ist aber \emph{ziemlich groÃŸ}
    (meist $n âˆ¼ 10â´ \text{ â€“ } 10â¶$).

    \begin{itemize}
    \item[â‡’] hoher Speicherbedarf
      ($â‰« 10â¶$ Koeffizienten $â‰  0$)
    \end{itemize}

  \item $Eáµ¢ = 0$, auÃŸer wenn $Aáµ¢$ selbst leuchtet.
  \end{enumerate}
  \Reached{WS16/17}{12}{2017/01/19}
\end{bemerkungen}


\subsection{Vom Gleichungssystem zum Bild}

Die LÃ¶sung des Gleichungssystems gibt die Helligkeit der Patches an;
sie ist \emph{unabhÃ¤ngig davon, von wo aus die Szene betrachtet wird}.

\begin{itemize}
\item[â‡’] Aus der LÃ¶sung kÃ¶nnen mit geringem Aufwand mehrere
  Ansichten der Szene erstellt werden

  (\zB â€Walk Throughâ€œ-Animation in Echtzeit).
\end{itemize}

Die eigentliche Bilderzeugung erfordert dann nur noch die Wiedergabe der
Patches.
Dies geschieht \zB mit einer Kombination aus
\begin{itemize}
\item geeigneter 3D â†’ 2D-Transformation,
\item $z$-Puffer-Algorithmus,
\item Gouraud-Shading.
\end{itemize}

\begin{description}
\item[Problem:] Beim Radiosity-Verfahren erhÃ¤lt jeder \emph{Patch} konstante
  Helligkeit zugeordnet.
  Hieraus mÃ¼ssen Helligkeiten fÃ¼r die \emph{Knoten} abgeleitet
  werden, so dass Gouraud-Shading an den Objekt-internen
  Patchgrenzen stetige FarbÃ¼bergÃ¤nge liefert.

\item[Ansatz:] Inter- \bzw Extrapolation

  \begin{center}
    \scalebox{0.5}{\huge\input{fig_farbeRadiosityInterpolation}}%â‚â‚‘áµ¢áµ£
  \end{center}

  \begin{description}
  \item[Fall~1:] $\point{V}áµ¢$ ist â€innere Eckeâ€œ.
    \[ B\fk{\point{V}áµ¢} := \frac14 Â·
      \rk{\underbrace{Bâ‚ + B_b + B_c + B_d}_{\text{Radiosities der mit $\point{V}áµ¢$
            inzidenten Patches}}} \]

  \item[Fall~2:] $\point{V}áµ£$ ist â€Randeckeâ€œ, aber nicht
    Ecke des Objekts.

    Seien $A_b$ und $A_d$ die mit $\point{V}áµ£$ inzidenten
    Patches, $\point{V}áµ¢$ der andere (im Innern des Objektes
    gelegene) Endpunkt und $\point{M}$ der Mittelpunkt der
    Grenze $A_b | A_d$.
    \[ B\fk{\point{V}áµ£} := 2 B(\point{M}) - B\fk{\point{V}áµ¢} \]
    mit
    \[ B(\point{M}) := \frac12 Â· \rk{B_b + B_d} \]

  \item[Fall~3:] $\point{V}â‚‘$ ist Ecke des Objekts.

    Sei $A_b$ der mit $\point{V}â‚‘$ inzidente Patch und
    $\point{V}áµ¢$ die (auf $A_b$) â€gegenÃ¼berliegendeâ€œ
    innere Ecke.
    \[ B\fk{\point{V}â‚‘} := 2 B_b - B\fk{\point{V}áµ¢} \]
  \end{description}
\end{description}
\Reached{WS15/16}{10}{2016/01/14}


\subsection{Die Formfaktoren}
\label{subsec:faerbungFormfaktoren}

Von $\dd Aáµ¢$ aus ist statt $\dd Aâ±¼$ nur die verkÃ¼rzte FlÃ¤che
\[ \dd Aâ±¼' = \dd Aâ±¼ Â· \cos Ï†â±¼ \]
sichtbar.

\begin{center}
  \scalebox{0.5}{\huge\input{fig_farbeRadiosityFormfaktor}}%Ï†Ï‰áµ¢â±¼
\end{center}

Von $\dd Aâ±¼$ aus erscheint die (verkÃ¼rzte) FlÃ¤che $\dd Aáµ¢'$ unter
dem Raumwinkel
\[ \dd Ï‰ = \frac{\dd Aáµ¢ Â· \cos Ï†áµ¢}{rÂ²} \,\text. \]
Also erhÃ¤lt $\dd Aáµ¢$ von $\dd Aâ±¼$ die Energie
\begin{align*}
  E_{\dd Aâ±¼,\dd Aáµ¢} &= Bâ±¼ Â· \dd Aâ±¼' Â· \dd Ï‰ Â·
  \underbrace{Hâ±¼áµ¢}_{\makebox(0,0)[t]{\small \begin{tabular}{ll}
        $= 1$ & falls $\dd Aâ±¼$ von $\dd Aáµ¢$ aus sichtbar ist \\
        $= 0$ & sonst\end{tabular}}} \\[16mm]
  &= \frac{Bâ±¼ Â· \cos Ï†áµ¢ Â· \cos Ï†â±¼}{rÂ²} Â· Hâ±¼áµ¢ Â· \dd Aâ±¼ Â· \dd Aáµ¢ \,\text,
\end{align*}

und damit erhÃ¤lt Patch $Aáµ¢$ von Patch $Aâ±¼$ die Energie
\[ E_{Aâ±¼, Aáµ¢} = âˆ«_{Aáµ¢} âˆ«_{Aâ±¼} \frac{Bâ±¼ Â· \cos Ï†áµ¢ Â· \cos Ï†â±¼}{rÂ²} Â· Hâ±¼áµ¢ Â· \dd Aâ±¼ Â· \dd Aáµ¢ \,\text. \]
Die gesamte Abstrahlung von $Aâ±¼$ ist
\begin{align*}
  E_{Aâ±¼} &= âˆ«_{Aâ±¼} E_{\dd Aâ±¼} \, \dd Aâ±¼ \\
  &= âˆ«_{Aâ±¼} Ï€ Bâ±¼ \, \dd Aâ±¼
  \qquad \text{\cmt{gemÃ¤ÃŸ \eqref{eq:radiosityEdA}}} \\
  &= Ï€ Bâ±¼ Aâ±¼ \,\text.
\end{align*}
Damit folgt
\begin{equation}
  Fâ±¼áµ¢ = \frac{E_{Aâ±¼, Aáµ¢}}{E_{Aâ±¼}}
  = \frac{1}{Aâ±¼} Â· âˆ«_{Aáµ¢} âˆ«_{Aâ±¼} \frac{\cos Ï†áµ¢ Â· \cos Ï†â±¼}{Ï€ rÂ²}
  Hâ±¼áµ¢ \, \dd Aâ±¼ \, \dd Aáµ¢ \,\text.
  \label{eq:radiosityFormfaktorIntegral}
\end{equation}

\begin{bemerkungen} \mbox{}
  \begin{enumerate}
  \item Aus \eqref{eq:radiosityFormfaktorIntegral} folgt wegen
    $Hâ±¼áµ¢ = Háµ¢â±¼$ sofort die Symmetriebeziehung \eqref{eq:radiositySymmetrie}.

  \item FÃ¼r die Berechnung der $Fáµ¢â±¼$ mit dem Computer ist
    \eqref{eq:radiosityFormfaktorIntegral} nicht zu gebrauchen
    (Vierfach-Integral, \usw).

  \item \eqref{eq:radiosityFormfaktorIntegral} kÃ¶nnte mit dem
    Satz von Stokes in ein doppeltes Kontur-Integral umgewandelt
    werden.
  \end{enumerate}
\end{bemerkungen}
\Reached{WS18/19}{11}{2019/01/10}

\pagebreak


\subsection{Numerische Berechnung der Formfaktoren}

\begin{description}
\item[Vereinfachung 1:] $Ï†áµ¢$, $Ï†â±¼$, $r$ und $Hâ±¼áµ¢$ seien unabhÃ¤ngig
  von dem gerade auf $Aâ±¼$ betrachteten Punkt.

  (liefert gute NÃ¤herung, falls $Aâ±¼$ klein gegenÃ¼ber $r$)
\end{description}

Einsetzen in \eqref{eq:radiosityFormfaktorIntegral} ergibt
\begin{align}
  Fâ±¼áµ¢ &= \frac{1}{Aâ±¼} Â· âˆ«_{Aáµ¢} \frac{\cos Ï†áµ¢ Â· \cos Ï†â±¼}{Ï€ rÂ²} Hâ±¼áµ¢ \, \dd Aáµ¢
  Â· âˆ«_{Aâ±¼} \dd Aâ±¼ \nonumber \\
  &= âˆ«_{Aáµ¢} \frac{\cos Ï†áµ¢ Â· \cos Ï†â±¼}{Ï€ rÂ²} Hâ±¼áµ¢ \, \dd Aáµ¢ \,\text.
  \label{eq:radiosityFormfaktorVereinfachung1}
\end{align}
Als â€Referenzpunktâ€œ $\point{P}â±¼$ auf $Aâ±¼$ wird dann
beispieleweise der Mittelpunkt von $Aâ±¼$ gewÃ¤hlt.

\pagebreak

\vspace*{-18mm}
\begin{bemerkung}
  Der Wert $Fâ±¼áµ¢$ in \eqref{eq:radiosityFormfaktorVereinfachung1}
  kann auch geometrisch gewonnen werden (ohne Beweis).

  \begin{center}
    \scalebox{0.5}{\huge\input{fig_farbeRadiosityFormGeometrisch}}%áµ¢â±¼
  \end{center}

  \begin{itemize}
  \item Projiziere den sichtbaren Teil von $Aáµ¢$ auf die
    Einheitshalbkugel
    \cmt{in Richtung $\widehat{\vektor{n}}â±¼$}
    um $\point{P}â±¼$.

    (Dies liefert
    $\displaystyle{âˆ«_{Aáµ¢} \frac{\cos Ï†áµ¢}{rÂ²} Hâ±¼áµ¢ \, \dd Aáµ¢}$.)

  \item Projiziere diese FlÃ¤che auf den â€Grundkreisâ€œ der
    Halbkugel (liefert $\cos Ï†â±¼$).

  \item Dividiere diese FlÃ¤che durch die KreisflÃ¤che
    (liefert $\frac1Ï€$).
  \end{itemize}

  Der Formfaktor ist also aus der Projektion des Patches $Aáµ¢$ auf
  die Einheitskugel (GrÃ¶ÃŸe und Lage der projizierten FlÃ¤che)
  ableitbar.
\end{bemerkung}

\begin{description}
\item[Beobachtung:] Statt der Einheitshalbkugel ist auch eine beliebige konvexe
  â€Halbumgebungâ€œ von $\point{P}â±¼$ verwendbar, \zB ein
  \emph{HalbwÃ¼rfel}:

  \begin{center}
    \scalebox{0.45}{\huge\input{fig_farbeRadiosityFormZellen1}}%áµ¢â±¼
  \end{center}

  (Vom HalbwÃ¼rfel kann â€weiterâ€œ auf die Halbkugel projiziert
  werden.)

  \pagebreak

\item[Vereinfachung 2:] Zerlege die OberflÃ¤che des HalbwÃ¼rfels in kleine FlÃ¤chenstÃ¼cke
  \emph{(Zellen)}\index{Zelle bei Formfaktorberechnung}\index{Formfaktor!Zelle}
  $C_q$ und ersetze die Projektion durch die Vereinigung der davon
  erfassten Zellen (â‰™ \emph{Diskretisierung}).

  \begin{center}
    \scalebox{0.425}{\huge\input{fig_farbeRadiosityFormZellen2}}%áµ¢â±¼
  \end{center}

\item[Beobachtung:] Jede Zelle $C_q$ liefert einen Beitrag $Î”F_q$ zu
  $Fâ±¼áµ¢$:
  \[ Fâ±¼áµ¢ = âˆ‘_{q : \text{$C_q$ wird bei der Projektion von $Aáµ¢$ erfasst}} Î”F_q \]
  mit
  \[ Î” F_q = \frac{\text{Projektion von $C_q$ auf Einheitskugel und
        Kreis}}{\text{KreisflÃ¤che}} \]
\end{description}

\pagebreak

\begin{bemerkung}
  Die  \emph{Delta-Formfaktoren}\index{Delta-Formfaktor} $Î”F_q$
  hÃ¤ngen nur von der Unterteilung des WÃ¼rfels in Zellen ab, nicht von
  projiziertem Patch $Aáµ¢$ oder von $Aâ±¼$
  \cmt{letzteres nur, wenn alle HalbwÃ¼rfel um die $\point{P}â±¼$ gleich unterteilt werden}.

  \begin{itemize}
  \item[â‡’] Die $Î”F_q$ kÃ¶nnen \emph{vorab} berechnet werden!
  \end{itemize}

  Oft ist es gÃ¼nstiger, die zu verschiedenen $Pâ±¼$ gehÃ¶rigen
  HalbwÃ¼rfel â€“ oder sogar die verschiedenen FlÃ¤chen eines
  HalbwÃ¼rfels â€“ unterschiedlich fein zu unterteilen.
  Dann sind mehrere (\zB 4) â€SÃ¤tzeâ€œ der $Î”F_q$ zu
  speichern.

  typische Anzahl der Zellen pro HalbwÃ¼rfelflÃ¤che: 100 â€“ 100\,000
\end{bemerkung}

\pagebreak

\begin{description}
\item[Berechnung der Delta-Formfaktoren:] \mbox{}

  \begin{center}
    \scalebox{0.5}{\huge\input{fig_farbeRadiosityFormZellen3}}%Ï†
  \end{center}
\end{description}

GemÃ¤ÃŸ \eqref{eq:radiosityFormfaktorVereinfachung1} gilt
\[ Î”F_q = âˆ«_{C_q} \frac{\cos Ï†_q Â· \cos Ï†_{\point{P}}}{Ï€ rÂ²} \, \dd C_q \,\text.\]
\cmt{$H â‰¡ 1$, da die ganze Zelle von $\point{P}$ aus sichtbar ist.}

\begin{description}
\item[Vereinfachung 3:] $Ï†_q$, $Ï†_{\point{P}}$ und $r$ seien unabhÃ¤ngig von
  dem gerade auf $C_q$ betrachteten Punkt $\point{P}_q$.
\end{description}

Dann ist
\[ Î”F_q = \frac{\cos Ï†_q Â· \cos Ï†_{\point{P}}}{Ï€ rÂ²}
  Â· \underbrace{C_q}_{\text{FlÃ¤che der Zelle}} \,\text. \]

Als â€Referenzpunktâ€œ wÃ¤hlt man etwa den Mittelpunkt
$\point{P}_q = \rk{r_q, s_q, t_q}$ von $C_q$.

\begin{description}
\item[Fall a:] $C_q$ liegt auf der â€DeckflÃ¤cheâ€œ des WÃ¼rfels.

  \begin{center}
    \scalebox{0.5}{\huge\input{fig_farbeRadiosityFormZellen3}}
  \end{center}

  Dann ist
  \begin{align*}
    t_q &= 1 \,, \\
    r &= \sqrt{r_qÂ² + s_qÂ² + t_qÂ²} = \sqrt{r_qÂ² + s_qÂ² + 1} \,\text, \\
    \cos Ï†_q &= \cos Ï†_{\point{P}} = \frac1r
  \end{align*}
  und damit
  \[ Î”F_q = \frac{C_q}{Ï€ râ´} = \frac{C_q}{Ï€ \rk{r_qÂ² + s_qÂ² + 1}Â²} \,\text. \]

  \pagebreak

\item[Fall b:] $C_q$ liegt auf einer SeitenflÃ¤che $s_q = Â±1$.

  \begin{center}
    \scalebox{0.5}{\huge\input{fig_farbeRadiosityFormZellen4}}%Ï†
  \end{center}

  Dann ist
  \begin{align*}
    r &= \sqrt{r_qÂ² + 1 + t_qÂ²} \,\text, \\
    \cos Ï†_q &= \frac1r \,\text, \\
    \cos Ï†_{\point{P}} &= \frac{t_q}{r}
  \end{align*}
  und damit
  \[ Î”F_q = \frac{t_q Â· C_q}{Ï€ \rk{r_qÂ² + 1 + t_qÂ²}Â²} \,\text. \]

\item[Fall c:] $C_q$ liegt auf einer SeitenflÃ¤che $r_q = Â±1$.
  Dann folgt analog
  \[ Î”F_q = \frac{t_q Â· C_q}{Ï€ \rk{1 + s_qÂ² + t_qÂ²}Â²} \,\text. \]
\end{description}

\begin{bemerkung}
  Aus SymmetriegrÃ¼nden mÃ¼ssen nur die Delta-Formfaktoren fÃ¼r ein
  Achtel der DeckflÃ¤che und eine halbe SeitenflÃ¤che wirklich
  berechnet werden.
\end{bemerkung}

\pagebreak

\begin{description}
\item[Problem:] Wie bestimmt man mÃ¶glichst effizient die von der Projektion (der
  nicht verdeckten Teile) von $Aáµ¢$ erfassten Zellen?

\item[Idee:] Die Zellen auf einer FlÃ¤che des HalbwÃ¼rfels kÃ¶nnen als
  \emph{Pixmap} interpretiert werden.

  \begin{itemize}
  \item[â‡’] Die erfassten Zellen ergeben sich durch
    perspektivische Projektion \bzgl $\point{P}â±¼$ und
    anschlieÃŸende \emph{Scan Conversion}.
  \end{itemize}

  Mit einem \emph{$\mathbf{z}$-Puffer}-Ã¤hnlichen Ansatz kann dabei auch
  gleich die Verdeckungsanalyse durchgefÃ¼hrt werden.

  \begin{itemize}
  \item[â‡] \emph{Objektpuffer}\index{Objektpuffer zur Formfaktorberechnung}%
    \index{Formfaktor!Objektpuffer}:
    Speichere fÃ¼r jede Zelle $C_q$ die Nummer $i_q$ und
    die Entfernung $d_q$ des dort gerade sichtbaren Patches.

    \begin{center}
      \scalebox{0.5}{\Large\input{fig_farbeRadiosityFormZellen5}}%â‚â‚‚â‚ƒâ±¼
    \end{center}
  \end{itemize}
\end{description}

\pagebreak

\begin{algorithmus} \mbox{}
  \begin{AlgListInline}
    Algorithmus Bestimmung der Formfaktoren $Fâ±¼áµ¢$, $\myred{i = 1, â€¦, n}$

    // Initialisiere Objektpuffer
    fÃ¼r alle Zellen $C_q$ des HalbwÃ¼rfels
    Â°Â°Â°$\rk{i_q, d_q}$ := $\rk{0, +âˆ}$Â°Â°Â°Â°Â°Â°Â°// â€Hintergrundâ€œ
    // Projiziere alle $Aáµ¢$ auf den HalbwÃ¼rfel um $\point{P}â±¼$
    fÃ¼r $i = 1, â€¦, n$
    Â°Â°Â°fÃ¼r jede der fÃ¼nf FlÃ¤chen des HalbwÃ¼rfels
    Â°Â°Â°Â°Â°Â°projiziere $Aáµ¢$ auf die FlÃ¤che und fÃ¼hre Scan Conversion durch
    Â°Â°Â°Â°Â°Â°fÃ¼r jede hierbei gelieferte Zelle $C_q$
    Â°Â°Â°Â°Â°Â°Â°Â°Â°bestimme den Abstand $d$ des zugehÃ¶rigen Punktes auf $Aáµ¢$ von $\point{P}â±¼$
    Â°Â°Â°Â°Â°Â°Â°Â°Â°wenn $d < d_q$Â°Â°Â°Â°Â°Â°Â°// Patch $Aáµ¢$ bei $C_q$ sichtbar?
    Â°Â°Â°Â°Â°Â°Â°Â°Â°Â°Â°Â°$\rk{i_q, d_q}$ := $\rk{i, d}$
    // Berechne aus den Projektionen die Formfaktoren
    fÃ¼r $i = 1, â€¦, n$
    Â°Â°Â°$Fâ±¼áµ¢$ := $âˆ‘_{q : i_q=i} Î”F_q$Â°Â°Â°Â°Â°Â°Â°// Summe Ã¼ber die Zellen, bei denen $Aáµ¢$ sichtbar ist
  \end{AlgListInline}
\end{algorithmus}

\pagebreak

\begin{bemerkungen} \mbox{}
  \begin{enumerate}
  \item Vereinfachung~1 (ersetze $Aâ±¼$ durch $\point{P}â±¼$)
    fÃ¼hrt dazu, dass sich ausgedehnte Lichtquellen (\zB Fenster,
    LeuchtkÃ¶rper) wie Punktlichtquellen verhalten.

    \begin{center}
      \scalebox{0.5}{\huge\input{fig_farbeRadiosityLichtquellen}}
    \end{center}

    \begin{itemize}
    \item[â‡’] Ausgedehnte Lichtquellen mÃ¼ssen \iA in relativ
      kleine Patches zerlegt werden.
    \end{itemize}

  \item Alle drei Vereinfachungen kÃ¶nnen zu wesentlichen Fehlern in
    den $Fâ±¼áµ¢$ fÃ¼hren, wenn

    \begin{itemize}
    \item die Patches (relativ zu ihrer GrÃ¶ÃŸe) nahe
      beieinander liegen, \zB aneinanderstoÃŸen

      \begin{verse}
        (\textbf{Regel:}
        $\text{Abstand} â‰¥ 5 Â· \text{Patchdurchmesser}$)
      \end{verse}

    \item der HalbwÃ¼rfel in zu wenige Zellen unterteilt wird.
    \end{itemize}

  \item trotz der Vereinfachungen \emph{sehr hoher Aufwand}:
    \[ \underbrace{\text{\emph{$n$-mal }}}_{\makebox(0,0)[t]{\small
          fÃ¼r $j = 1, â€¦, n$}}
      \text{\emph{ komplette }}
      \underbrace{\text{\emph{ â€Bilderzeugungâ€œ}}}_{\parbox[t]{4cm}{\small
          Projektion\par
          Scan Conversion\par
          Verdeckungsanalyse}} \]
    allerdings fÃ¼r â€Pixmapsâ€œ verhÃ¤ltnismÃ¤ÃŸig geringer
    Auf\/lÃ¶sung
  \end{enumerate}
\end{bemerkungen}
\Reached{WS17/18}{12}{2018/01/11}

\pagebreak


\subsection{Schrittweiser LÃ¶sungsaufbau}

\begin{description}
\item[Motivation:] \mbox{}

  \begin{itemize}
  \item Die Berechnung der $Báµ¢$ ist sehr aufwÃ¤ndig.

    \begin{itemize}
    \item[â‡’] Ist es mÃ¶glich, schon relativ frÃ¼h eine
      â€grobeâ€œ NÃ¤herung zu erhalten und diese im Laufe
      der Zeit zu verbessern?
    \end{itemize}

  \item Die $Fâ±¼áµ¢$ erfordern sehr viel Speicher.

    \begin{itemize}
    \item[â‡’] Kann das Verfahren so umstrukturiert
      werden, dass immer nur ein kleiner Teil der $Fâ±¼áµ¢$
      gleichzeitig benÃ¶tigt wird?
    \end{itemize}
  \end{itemize}
\end{description}

\begin{description}
\item[Ansatz:] geeigneter iterativer Algorithmus zur LÃ¶sung des LGS
\end{description}

\emph{GauÃŸ-Seidel-Verfahren} zur LÃ¶sung von
\eqref{eq:radiosityLGS}:

\begin{AlgListInline}
  starte mit $Báµ¢ = Eáµ¢$, $i = 1, â€¦, n$
  wiederhole bis gewÃ¼nschte Genauigkeit erreicht
  Â°Â°Â°fÃ¼r $i = 1, â€¦, n$
  Â°Â°Â°Â°Â°Â°$Báµ¢$ := $Eáµ¢ + Ïáµ¢ Â· âˆ‘â±¼â‚Œâ‚â¿ Fáµ¢â±¼ Â· Bâ±¼$
\end{AlgListInline}

Die neue Radiosity $Báµ¢$ von $Aáµ¢$ ergibt sich also durch
â€Einsammelnâ€œ \emph{(Gather)}\index{Gather bei Radiosity}\index{Radiosity!Gather}
der BeitrÃ¤ge $Ïáµ¢ Â· Fáµ¢â±¼ Â· Bâ±¼$ der anderen Patches.

\pagebreak

\begin{description}
\item[Idee:] Betrachte die umgekehrte AbhÃ¤ngigkeit: (nach Cohen/Chen/Wallace/Greenberg 1988)

  Wie Ã¤ndern sich die Ã¼brigen Radiosities, wenn sich $Báµ¢$ um
  $Î”Báµ¢$ Ã¤ndert \emph{(Shoot)}\index{Shoot bei Radiosity}\index{Radiosity!Shoot}?

  \begin{center}
    \scalebox{0.45}{\huge\input{fig_farbeRadiosityGatherShoot}}%Î”Ïáµ¢â±¼
  \end{center}
  \personHidden{-5mm}{Michael F.~Cohen}{}{}{}{person_CohenM}{}%
  {\urlpers{https://www.siggraph.org/about/awards/1998-cg-award/}}{}%
  
  \personHidden{-15mm}{Shenchang Eric Chen}{}{}{}{person_Chen}{}%
  {\urlpers{https://www.linkedin.com/in/ec19801}}%
  {}%
  
  \personHidden{-25mm}{John R.~Wallace}%
  {}{}{}%
  {person_nopic}{}{}{}%
  \vspace*{40mm}
  \Reached{WS19/20}{12}{2020/01/09}

  \pagebreak

  \vspace*{-19mm}
\item[Antwort] auf die Frage:
  \vspace*{-9mm}
  \begin{align*}
    Î”Bâ±¼ &= Ïâ±¼ Fâ±¼áµ¢ Â· Î”Báµ¢ \\
    &= Ïâ±¼ Fáµ¢â±¼ Â· \frac{Aáµ¢}{Aâ±¼} Â· Î”Báµ¢ \qquad
    \text{\cmt{gemÃ¤ÃŸ \eqref{eq:radiositySymmetrie}}}
  \end{align*}
\end{description}

\begin{algorithmus} \mbox{}
  \begin{AlgListInline}
    Algorithmus Schrittweiser LÃ¶sungsaufbau

    fÃ¼r $i = 1, â€¦, n$
    Â°Â°Â°$Báµ¢$ := $Eáµ¢$Â°Â°Â°Â°Â°Â°Â°// berÃ¼cksichtige nur Eigenemission
    Â°Â°Â°$\widetilde{Î”}Báµ¢$ := $Eáµ¢$ Â°Â°Â°Â°Â°Â°Â°// um wie viel hat sich $Báµ¢$ geÃ¤ndert, seit $Aáµ¢$ letztmalig ausgewÃ¤hlt wurde?
    ggf. Â§AnsichtÂ§ erstellen
    wiederhole bis gewÃ¼nschte Genauigkeit erreicht
    Â°Â°Â°wÃ¤hle einen Patch $Aáµ¢$ mit maximalem $\widetilde{Î”}Báµ¢ Â· Aáµ¢$Â°// MaÃŸ fÃ¼r Ã„nderung der ges. abgestrahlten Energie
    Â°Â°Â°bestimme $Fáµ¢â±¼$, $j = 1, â€¦, n$
    Â°Â°Â°fÃ¼r $j = 1, â€¦, n$
    Â°Â°Â°Â°Â°Â°$Î”Bâ±¼$ := $Ïâ±¼ Fáµ¢â±¼ \frac{Aáµ¢}{Aâ±¼} Â· Î” Báµ¢$
    Â°Â°Â°Â°Â°Â°$Bâ±¼$ := $Bâ±¼ + Î”Bâ±¼$
    Â°Â°Â°Â°Â°Â°$\widetilde{Î”}Bâ±¼$ := $\widetilde{Î”}Bâ±¼ + Î”Bâ±¼$
    Â°Â°Â°ggf. Â§AnsichtÂ§ erstellen
    Â°Â°Â°$\widetilde{Î”}Báµ¢$ := $0$
  \end{AlgListInline}
\end{algorithmus}

\pagebreak

\begin{bemerkungen} \mbox{}
  \begin{enumerate}
  \item Zu Beginn sind nur die selbst emittierenden Objekte
    sichtbar, dann wird der Beitrag des stÃ¤rksten Strahlers an
    alle Objekte berÃ¼cksichtigt, dann der zweitstÃ¤rkste \usw

    \begin{itemize}
    \item[â‡’] Die Szene ist anfangs Ã¼berwiegend dunkel und
      hellt sich langsam auf.
    \end{itemize}

  \item Wenn die $Fáµ¢â±¼$ â€schnell genugâ€œ erzeugt werden
    kÃ¶nnen (\zB mit einer $z$-Puffer-Hardware), dann muss nur noch
    eine \emph{Zeile} der Radiosity-Matrix gespeichert werden; die
    Formfaktoren werden allerdings mehrmals berechnet.

    \begin{itemize}
    \item[â‡’] MÃ¶glichkeit, die Formfaktoren im Laufe der
      Zeit zu Ã¤ndern
    \end{itemize}
  \end{enumerate}
\end{bemerkungen}

\pagebreak

\pngpage{Bilder/radios/sceneSortMod-h500-00001}
\pngpage{Bilder/radios/sceneSortMod-h500-00015}
\pngpage{Bilder/radios/sceneSortMod-h500-00050}
\pngpage{Bilder/radios/sceneSortMod-h500-00400}
\pngpage{Bilder/radios/sceneSortMod-h500-00600}
\pngpage{Bilder/radios/sceneSortMod-h500-03000}
\pngpage{Bilder/radios/sceneSortMod-h500-25000}
\pngpage{Bilder/radios/sceneSortMod-h500-80000}

\pagebreak


\vspace*{-23mm}
\subsection{Unterteilung der Patches}

\begin{description}
\item[Problem:] Oft wird nach der Berechnung der Formfaktoren und dem LÃ¶sen des
  Gleichungssystems deutlich, dass die ursprÃ¼ngliche Unterteilung
  in Patches zu grob war.

  \begin{description}
  \item[typisches Kriterium:] groÃŸe Radiosity-Unterschiede
    zwischen benachbarten Patches

    \begin{itemize}
    \item[â‡’] Die Patches enthalten einen deutlichen
      FarbÃ¼bergang (\zB \emph{Schattengrenze}).

      Dieser wird bei der Wiedergabe der Patches
      â€glattinterpoliertâ€œ.

      \begin{center}
        \scalebox{0.5}{\huge\input{fig_farbeRadiositySchattengrenze}}%áµ¢â±¼
      \end{center}

    \item[â‡] Nach der Interpolation ist der Ãœbergang
      nicht mehr lokalisierbar.
    \end{itemize}
  \end{description}

\item[Ansatz I:] ErhÃ¶he die Anzahl der Patches auf $N$ und fange wieder von vorne
  an:

  \begin{center}
    \begin{tabular}{Ll}
      \mdef{NÂ²} & Formfaktoren berechnen \\
      \mdef{N Ã— N} & Gleichungssysteme lÃ¶sen
    \end{tabular}
  \end{center}

  \begin{itemize}
  \item[â‡’] fÃ¼r $N â‰« n$ starke Zunahme des Aufwands
  \end{itemize}

\item[Ansatz II:] Unterteile, wo notwendig, die Patches in
  \emph{Elemente}\index{Element bei Radiosity}\index{Radiosity!Element}:
  \[ Aáµ¢ â‡ A_{i,1}, â€¦, A_{i,máµ¢} \]

  \begin{itemize}
  \item Der Einfluss der Ã¼brigen Patches $Aâ±¼$ auf $Aáµ¢$
    wird fÃ¼r jedes Element $A_{i,q}$ von $Aáµ¢$ bestimmt.

    \begin{itemize}
    \item[â‡’] Die BeleuchtungsverhÃ¤ltnisse auf $Aáµ¢$
      kÃ¶nnen detaillierter modelliert werden.
    \end{itemize}

  \item Der Einfluss von $Aáµ¢$ auf die Ã¼brigen $Aâ±¼$ wird
    \emph{summarisch} bestimmt, \dH die Elemente von $Aáµ¢$
    werden hierzu zusammengefasst.

    \begin{itemize}
    \item[â‡’] Reduktion des Rechenaufwands
    \end{itemize}
  \end{itemize}

  \begin{enumerate}
  \item[i)] Berechne die $\mdef{N Â· n}$ Formfaktoren
    $F_{j,i_q}$
    \cmt{Anteil des von $Aâ±¼$ ausgehenden Lichts, das bei
      Element $A_{i,q}$ eintrifft}
    \bzw $F_{i_q,j}$.

  \item[ii)] Verwende die LÃ¶sung $\rk{Bâ±¼ : j = 1, â€¦, n}$
    des ursprÃ¼nglichen $n Ã— n$-Gleichungssystems und
    berechne hieraus die Element-Radiosities gemÃ¤ÃŸ
    \begin{equation}
      \label{eq:radiosityElement}
      B_{i,q} = \underbrace{Eáµ¢}_{\text{\evtl\ } E_{i,q}}
      + \underbrace{Ïáµ¢}_{\text{\evtl\ } Ï_{i,q}}
      Â· âˆ‘â±¼â‚Œâ‚â¿ Bâ±¼ F_{i_q,j} \,\text.
    \end{equation}
  \end{enumerate}

  \pagebreak

\item[Ansatz III:] Ã¤hnlich wie II, aber
  \begin{enumerate}
  \item[ii)] Berechne verbesserte
    â€Patch-zu-Patchâ€œ-Formfaktoren
    \[ \widetilde{F}áµ¢â±¼ = \frac{1}{Aáµ¢}
      Â· âˆ‘_{q=1}^{máµ¢} F_{i_q,j} Â· A_{i,q} \]
    \cmt{FlÃ¤chen-gewichtetes Mittel der $F_{i_q,j}$}.
    
  \item[iii)] Berechne die Patch-Radiosities $Bâ±¼$ Ã¼ber ein
    $\mdef{n Ã— n}$-Gleichungssystem (mit
    $\widetilde{F}áµ¢â±¼$ statt $Fáµ¢â±¼$).
    
  \item[iv)] Berechne hieraus die Element-Radiosities gemÃ¤ÃŸ
    \eqref{eq:radiosityElement}.
  \end{enumerate}
\end{description}

\pagebreak

\begin{bemerkungen} \mbox{}
  \begin{enumerate}
  \item Die Elemente werden \ggf nochmals unterteilt:

    \begin{AlgListInline}
      solange es noch benachbarte Patches/Elemente mit Âºâ€Âºzu groÃŸemÂºâ€œÂº Radiosity-Unterschied gibt
      Â°Â°Â°unterteile diese in kleinere Elemente
      Â°Â°Â°berechne Radiosities (zumindest) ÂºfÃ¼rÂº die neuen Elemente
    \end{AlgListInline}

  \item Unterteilung in Elemente Ã¤ndert nichts an der Tatsache,
    dass emittierende Patches wie Punktlichtquellen strahlen

    \begin{itemize}
    \item[â‡’] Ausgedehnte Lichtquellen mÃ¼ssen (\iA bereits
      zu Beginn) in kleine \emph{Patches} zerlegt werden.
    \end{itemize}

  \item Die Unterteilung wird wÃ¤hrend des schrittweisen
    LÃ¶sungsaufbaus durchgefÃ¼hrt.
  \end{enumerate}
\end{bemerkungen}

\pagebreak

\vspace*{-32mm}
\subsection{Zusammenfassung}

\vspace*{-13mm}
\begin{center}
  \scalebox{0.45}{\huge\input{fig_farbeRadiosityAblauf}}%Î»Ïáµ¢
\end{center}

\begin{itemize}
\item[\Good] trotz der vielen Vereinfachungen gute Simulation von
  %% \imagelink{Bilder/cornell_radiosity}

  \begin{itemize}
  \item (mehrfacher) diffuser Reflexion

  \item ausgedehnten Lichtquellen
  \end{itemize}

\item[\Good] unabhÃ¤ngig von Betrachtungsposition
  
  â‡ fÃ¼r statische Szenen Vorabberechnung mÃ¶glich, dann sehr schnelles Rendering

\item[\Bad] keine BerÃ¼cksichtigung winkelabhÃ¤ngiger PhÃ¤nomene:

  \begin{itemize}
  \item winkelabhÃ¤ngige Reflexion

  \item Refraktion
  \end{itemize}

\item[\Bad] feine Unterteilung in Patches nÃ¶tig fÃ¼r gute Ergebnisse

\item[\Bad] Formfaktoren schwierig zu berechnen

\item[\Bad] insgesamt sehr aufwÃ¤ndig
\end{itemize}

\begin{bemerkung}
  Das Radiosity-Verfahren wird oft auf \emph{InnenrÃ¤ume} angewandt
  (Annahme eines geschlossenen Systems!).
  \Reached{WS14/15}{11}{2014/12/18}
  \Reached{WS15/16}{11}{2016/01/21}
  \Reached{WS16/17}{13}{2017/01/26}
\end{bemerkung}

\pagebreak

\pngpage{Bilder/yagir/cornell-radiosity}

\pagebreak

\mbox{}
\ReachedZoom{WS20/21}{11}{2021/01/21}
\Reached{WS21/22}{11}{2022/01/06}


\section{Rendergleichung und Monte-Carlo-Integration}

Notation von Funktionsargumenten mit Richtungen (nach
\cite{AdvancedGlobalIllumination2}):

\begin{tabular}{Cl}
  f(x â†’ Î˜) & Funktion $f(x, Î˜)$, vom Punkt $x$ ausgehend in Richtung $Î˜$ \\
  f(x â† Î˜) & Funktion $f(x, Î˜)$, den Punkt $x$ aus Richtung $Î˜$ treffend \\
  f(x, Î˜ â†” Î¨) & Funktion $f(x, Î˜, Î¨)$, aus Richtung $Î˜$ auf\/treffend und in
  Richtung $Î¨$ verlassend \bzw \\
  & umgekehrt (impliziert Helmholtz-ReziprozitÃ¤t [Umkehrbarkeit]) \\
  \rk{Î¨áµ€ Â· Î˜} & Kosinus als Skalarprodukt normalisierter Vektoren
\end{tabular}

\pagebreak


\subsection{Radiance}

\begin{description}
\item[\emph{Radiance\index{Radiance} (Strahldichte\index{Strahldichte})}]
  (\vgl\ref{subsec:radiosity}): die von einem Objekt pro Zeit- und 
  sichtbarer FlÃ¤cheneinheit in eine bestimmte Richtung
  abgestrahlte Energie pro Einheitsraumwinkel
\end{description}
% \imagelink{Grafiken/flux-irradiance-radiance}

\[ L(x, Ï‰) = \frac{\ddq Î¦(x, Ï‰)}{\dd A \cos(Ï†) \dd Ï‰} \]
\begin{tabular}{Ll}
  Î¦ & Strahlungsleistung (Strahlungsfluss, radiant flux) \\
  \dd A \cos(Ï†) & projiziertes FlÃ¤chenelement \\
  \dd Ï‰ & Raumwinkelelement
\end{tabular}

\begin{center}
  \input{fig_renderFluxIrradianceRadiance}%Ï†, Ï‰
\end{center}


\subsection{Rendergleichung}

\begin{description}
\item[\emph{Rendergleichgung \index{Rendergleichung} (rendering equation)}] \mbox{} \\
  1986 unabhÃ¤ngig von Immel/Cohen/Greenberg und Kajiya aufgestellt:
  
  \personHidden{10mm}{David S.~Immel}{}{}{}{person_nopic}{}{}{}%

  \person{-5mm}{James Thomas Kajiya}{1951}{}%
  {Informatiker}%
  {person_Kajiya}{Derrick Coetzee}%
  {\urlpers{https://de.wikipedia.org/wiki/Datei:Jim_Kajiya.jpg}}%
  {\cczero}%
  \vspace*{-15mm}

  \begin{align*}
    &\text{Radiance von $x$ in Richtung $Î˜$ ausgesendet } \\
    &= \text{emittierte Radiance } + \text{ reflektierte Radiance (aus
      allen Richtungen $Î¨$ der Halbkugel $Î©$)}
  \end{align*}
  
  \[ L(x â†’ Î˜) = Lâ‚‘(x â†’ Î˜) + âˆ«_Î© f(x, Î˜ â†” Î¨) Â· L(x â† Î¨) Â· \rk{Náµ€ Â· Î¨} \, \dd Ï‰ \]
  
  \begin{tabular}{Ll}
    L(x â†’ Î˜) & Radiance ausgehend von $x$ in Richtung $Î˜$ \\
    Lâ‚‘(x â†’ Î˜) & von $x$ in Richtung $Î˜$ emittierte Radiance \\
    f(x, Î˜ â†” Î¨) & BRDF \\
    L(x â† Î¨) & Radiance aus Richtung $Î¨$ \\
    N & Normale
  \end{tabular}
  
  BRDF: beschreibt Reflexions- und
  Absorptionseigenschaften des Materials (siehe \ref{subsec:BRDF})
\end{description}

\pagebreak

Die Radiance ist entlang gerader Linien (Strahlen) konstant (zumindest
im Vakuum).

Ist von einem Punkt $x$ in Richtung $Î¨$ der Punkt $x'$ sichtbar, dann gilt:

\[ \text{Radiance, die $x$ aus Richtung $Î¨$ empfÃ¤ngt }
  = \text{ Radiance, die $x'$ in Richtung $-Î¨$ aussendet} \]
also
\[ L\fk{x â† Î¨} = L\fk{x' â†’ -Î¨} \]

\pagebreak

\minisec{Formulierung mit FlÃ¤chenstÃ¼cken}

Erinnerung an Bemerkung~\ref{bem:verkuerzteFlaeche}:
$\dd Ï‰ = \frac{\cos Ï†}{rÂ²} \dd A = \frac{{N'}áµ€Â·-Î¨}{\norm{x-x'}Â²} \dd A$

Integriere Ã¼ber alle von $x$ sichtbaren FlÃ¤chenstÃ¼cke $A'$:

\[ L(x â†’ Î˜) = Lâ‚‘(x â†’ Î˜) + âˆ«_{A'} f(x, Î˜ â†” Î¨) Â· L\fk{x' â†’ -Î¨} Â· G\fk{x, x'} Â· V\fk{x, x'} \, \dd A'  \]
mit
\begin{align*}
  G\fk{x, x'} &= \frac{\rk{Náµ€ Â· Î¨} Â· \rk{{N'}áµ€ Â· -Î¨}}{\norm{x-x'}Â²} \\
  V\fk{x, x'} &= \begin{cases}
    1 & \text{ falls $x'$ von $x$ aus sichtbar ist} \\
    0 & \text{ sonst}
  \end{cases}
\end{align*}

\pagebreak

\begin{bemerkung}
  mit obiger Formulierung nicht modellierbar:
  \begin{itemize}
  \item AbhÃ¤ngigkeit von der WellenlÃ¤nge: Farbenzerstreuung
    (Dispersion) durch Prismen, chromatische Aberration \oae kann
    durch Sampling des Spektrums simuliert werden
    (\vgl \ref{sec:faerbungSampling}).
  \item Effekte der Wellenoptik wie Beugung (Diffraktion),
    Interferenz, Polarisation

    (DÃ¼nnfilm-Interferenz kann innerhalb der BRDF simuliert werden.)
  \item Transluzenz (partiell lichtdurchlÃ¤ssige Medien), Approximation
    fÃ¼r Volumenstreuung (subsurface scattering) mÃ¶glich oder
    Ausweitung auf Integration entlang des gesamten Pfades (full path
    integration) und Volumengrafik (volumetric rendering)
  \end{itemize}
\end{bemerkung}
\Reached{WS18/19}{12}{2019/01/17}

\pagebreak


\subsection{Zusammenhang zwischen Rendergleichung und Radiosity}

\begin{description}
\item[Radiosity:] gesamte von einem Punkt $x$ aus in
  \emph{alle Richtungen} abgestrahlte Leistung
\item[Annahme 1:] $L(x â†’ Î˜) = L(x)$ ist fÃ¼r alle Richtungen konstant
  (vollkommen diffuse Abstrahlung)
  \begin{align*}
    â‡’ \quad B(x) &= âˆ«_Î© L(x â†’ Î˜) Â· \rk{Náµ€ Â· Î˜} \, \dd Ï‰ \\
    &= L(x) Â· âˆ«_Î© \rk{Náµ€ Â· Î˜} \, \dd Ï‰ \\
    &= Ï€ L(x) \qquad \text{(\vgl Gleichung~\eqref{eq:radiosityEdA})}
  \end{align*}

  Formulierung der Rendergleichung mit FlÃ¤chenstÃ¼cken â€“ multipliziert
  mit $Ï€$ â€“ gibt:
  \[ B(x) = Eâ‚‘(x) + âˆ«_{A'} f(x, Î˜ â†” Î¨) Â· B\fk{x'} Â· G\fk{x, x'} Â· V\fk{x, x'} \, \dd A'  \]

\item[Annahme 2:] $f(x, Î˜ â†” Î¨) = \frac{Ï}{Ï€}$ konstant (vollkommen
  diffuse Abstrahlung)
  \[ â‡’ \quad B(x) = Eâ‚‘(x) + \frac{Ï}{Ï€} Â· âˆ«_{A'} B\fk{x'} Â· G\fk{x, x'} Â· V\fk{x, x'} \, \dd A'  \]

  Auf\/teilung in Patches ($A' = â‹ƒâ±¼â‚Œâ‚â¿ A_j$) und Aufsummierung der
  Radiosities gibt:
  \[ B(x) = Eâ‚‘(x) + \frac{Ï}{Ï€} Â· âˆ‘â±¼â‚Œâ‚â¿ âˆ«_{Aâ±¼} B\fk{xâ±¼} Â· G\fk{x, xâ±¼} Â· V\fk{x, xâ±¼} \, \dd Aâ±¼  \]

\item[Annahme 3:] Radiosity innerhalb der Patches konstant; verwende
  Mittelwert Ã¼ber die FlÃ¤che:
  \[ Báµ¢ = \frac{1}{Aáµ¢} Â· âˆ«_{Aáµ¢} B\fk{xáµ¢} \, \dd xáµ¢ \]
  Einsetzen ergibt:
  \begin{align*}
    Báµ¢ &=
    Eáµ¢ + \frac{1}{Aáµ¢} Â· âˆ«_{Aáµ¢} \frac{Ïáµ¢}{Ï€} Â· âˆ‘â±¼â‚Œâ‚â¿ Bâ±¼ Â· âˆ«_{Aâ±¼} G\fk{xáµ¢, xâ±¼} Â· V\fk{xáµ¢, xâ±¼} \, \dd Aâ±¼ \, \dd Aáµ¢ \\
    &= Eáµ¢ + Ïáµ¢ Â· \frac{1}{Aáµ¢} Â· âˆ‘â±¼â‚Œâ‚â¿ Bâ±¼
    Â· âˆ«_{Aáµ¢}âˆ«_{Aâ±¼} \frac{G\fk{xáµ¢, xâ±¼}}{Ï€} Â· V\fk{xáµ¢, xâ±¼} \, \dd Aâ±¼ \, \dd Aáµ¢ \\
    &= Eáµ¢ + Ïáµ¢ Â· \frac{1}{Aáµ¢} Â· âˆ‘â±¼â‚Œâ‚â¿ Bâ±¼
    Â· âˆ«_{Aáµ¢}âˆ«_{Aâ±¼} \frac{\rk{Náµ¢áµ€ Â· Î¨} Â· \rk{Nâ±¼áµ€ Â· - Î¨}}{Ï€ \norm{xáµ¢ - xâ±¼}Â²} Hâ±¼áµ¢ \, \dd Aâ±¼ \, \dd Aáµ¢ \\
    &= Eáµ¢ + Ïáµ¢ Â· \frac{1}{Aáµ¢} Â· âˆ‘â±¼â‚Œâ‚â¿ Bâ±¼ Â· âˆ«_{Aáµ¢}âˆ«_{Aâ±¼} \frac{\cos Ï†áµ¢ Â· \cos Ï†â±¼}{Ï€ ráµ¢â±¼Â²} Hâ±¼áµ¢ \, \dd Aâ±¼ \, \dd Aáµ¢
  \end{align*}
\end{description}
Das ist exakt Gleichung~\eqref{eq:radiosityFormfaktorIntegral}
eingesetzt in Gleichung~\eqref{eq:radiosityDiskret}, dividiert durch $Aáµ¢$.

\begin{description}
\item[\emph{also:}] Die Radiositygleichung ist ein Spezialfall der Rendergleichung.
\end{description}


\subsection{Monte-Carlo-Integration}%
\index{Monte-Carlo-Integration}

\begin{description}
\item[Frage:] Wie berechnet man
  \[ I = âˆ«_Î© g(x) \, \dd x \, \text? \]

\item[Idee:] WÃ¤hle $n$ zufÃ¤llige Richtungen, gleichmÃ¤ÃŸig verteilt Ã¼ber
  die Einheitshalbkugel $Î©$.
  \[ I â‰ˆ âˆ«_Î© \, \dd x Â· \frac1n âˆ‘áµ¢â‚Œâ‚â¿ g\fk{xáµ¢} = \frac{2Ï€}{n} âˆ‘áµ¢â‚Œâ‚â¿ g\fk{xáµ¢} \]
\end{description}

Aus der Rendergleichung wird dann:
\[ Lâ‚’áµ¤â‚œ â‰ˆ Lâ‚‘ + \frac{2Ï€}{n} âˆ‘áµ¢â‚Œâ‚â¿ \rk{fáµ¢ Â· Láµ¢ Â· \rk{Náµ€ Â· Î¨áµ¢}} \]

\begin{description}
\item[Konvergenz:] Standardabweichung $Ïƒ$ hat Konvergenzordnung $ğ’ª\fk{\frac{1}{\sqrt{n}}}$
  % Bei unabhÃ¤ngigen und identisch verteilten Samples
  % gilt fÃ¼r die Standardabweichung:
  % \[ Ïƒ\mk{\frac{c}{n}âˆ‘áµ¢â‚Œâ‚â¿ g\fk{xáµ¢}} = \frac{c}{\sqrt{n}} Ïƒ\mk{g(x)} \]
\end{description}

\pagebreak


\subsection{Erweiterungen des Raytracing-Modells}

Erweiterung des Whitted-Ansatzes zu
\emph{diffusem Raytracing (stochastisches Raytracing, \\
  distributed ray tracing)}%
\index{diffuses Raytracing}\index{stochastisches Raytracing}\index{Raytracing!diffuses}
(Cook/Porter/Carpenter 1984)
\person{19mm}{Robert L.~Cook}{1952, Knoxville, Tennessee}{}{Computergraphiker, Pixar}%
{person_Cook}{U.S.~General Services Administration}%
{\urlpers{https://commons.wikimedia.org/wiki/File:Rob_Cook.png}}{}%pd

\personHidden{4mm}{Thomas K.~Porter}{}{}{Computergraphiker, Pixar}{person_Porter}{}%
{\urlpers{http://www.fenn.org/page.cfm?p=574&newsid=225}}{}%

\personHidden{-11mm}{Loren C.~Carpenter}{1947, Brighton, Michigan}{}%
{Computergraphiker, Pixar}%
{person_Carpenter}{}%
{\urlpers{http://memory-alpha.wikia.com/wiki/Loren_Carpenter}}{}%
\vspace*{-19mm}

\begin{description}
\item[Idee:] verfolge mehrere zufÃ¤llig ausgewÃ¤hlte Strahlen
\item[ermÃ¶glicht:] \mbox{}
  \begin{itemize}
  \item weiche Schatten (durch mehrere Strahlen zu ausgedehnten
    Lichtquellen)
  \item TiefenunschÃ¤rfe (Wahl mehrerer Punkte in BlendenÃ¶ffnung des
    virtuellen Kamerasystems)
  \item verschwommene Reflexion bei glÃ¤nzenden OberflÃ¤chen (mehrere
    Reflexionsstrahlen)
  \item LichtdurchlÃ¤sssigkeit (Transluzenz) (mehrere
    Brechungsstrahlen)
  \item BewegungsunschÃ¤rfe (zeitliche Verteilung der Strahlen)
  \end{itemize}
  \begin{center}
    \input{fig_renderDistributedRayPath}
  \end{center}
  % \XXX ?: Grafik raytree?

  \pagebreak

\item[aber:]  \mbox{}
  \begin{itemize}
  \item nach wie vor nur Strahlen zu Lichtquellen, fÃ¼r Reflexion und
    Brechung
  \item keine BerÃ¼cksichtigung indirekter Beleuchtung (diffuse
    Reflexion) â€“ auÃŸer ambientem Anteil
  \item lÃ¶st nicht die Rendergleichung
  \item Aufwand durch starke Verzweigung der Strahlen
  \end{itemize}
\item[Umsetzung:] keine Strahlvervielfachung an jedem Objekt,
  sondern mehrere Strahlen pro Bildpunkt (wie fÃ¼r Antialiasing) â€“ danach Verzweigung wie bei
  Standard-Raytracing mit zufÃ¤lligen Richtungen
\end{description}
% \imagelinkadd{Grafiken/raytree}
\vspace*{-14mm}

\pagebreak

\pngpage{Bilder/yagir/cornell-distrt-pointlight}

\pngpage{Bilder/yagir/cornell-distrt-arealight}

\pngpage{Bilder/yagir/cornell-distrt-pointlight-depthoffield}

\pngpage{Bilder/yagir/cornell-distrt-arealight-depthoffield}

% \imagelink{Bilder/cornell_dl_pl}
% \imagelinkadd{Bilder/cornell_dl_al}
% \imagelinkadd{Bilder/cornell_dl_pl_dof}
% \imagelinkadd{Bilder/cornell_dl_al_dof}

\pagebreak


\subsection{Path Tracing}%
\index{Path Tracing}

\begin{description}
\item[Idee:] (nach Kajiya, 1986)
  \begin{itemize}
  \item fÃ¼r jeden Bildpunkt mehrere Strahlen
  \item Verfolgung eines einzelnen Strahls, \dH im Gegensatz zu
    Raytracing keine Aufspaltung in reflektierten oder gebrochenen
    Strahl
  \item Reflexion oder Brechung wird zufÃ¤llig entschieden
    (einschlieÃŸlich diffuser Reflexion)
  \item zufÃ¤llige Wahl der Richtung anhand BRDF, dadurch einheitliche
    Behandlung von indirekter Beleuchtung, Spiegelung, Brechung
  \item bei Treffen eines Objekts Lichtbeitrag aus einer zufÃ¤llig
    ausgewÃ¤hlten Lichtquelle

    (auch mÃ¶glich ohne Strahlverfolgung zu Lichtquellen, aber dann
    langsame Konvergenz durch zufÃ¤lliges Treffen der Lichtquellen)
  \end{itemize}
\end{description}

\begin{itemize}
\item[\Good] LÃ¶sung der Rendergleichung
\item[\Bad] benÃ¶tigt viele Strahlen (langsam), sonst Bildrauschen
\end{itemize}

\pagebreak

\pngpage{Bilder/yagir/cornell-pt}

\pagebreak

\Reached{WS17/18}{13}{2018/01/18}% eigtl. hinter pngpage

\vspace*{-20mm}
\subsection{BRDF}%
\label{subsec:BRDF}

\begin{description}
\item[BRDF\index{BRDF}:] bidirektionale Reflektanzverteilungsfunktion (bidirectional
  reflectance distribution function): beschreibt Reflexions- und
  Absorptionseigenschaften des Materials
\item[formale Definition:]
  \[ f(x, Î˜ â†” Î¨) = \frac{\dd L(x â†’ Î˜)}{L(x â† Î¨) \rk{Náµ€ Â· Î¨} \dd Ï‰} \quad
    \ek{\frac{1}{\text{sr}}} \]
  % \imagelink{Grafiken/brdf}
  % \imagelinkadd{Grafiken/brdfs4}
  % \imagelinkadd{Grafiken/brdfs5}
  \begin{center}
    \input{fig_renderBRDF1}%Î¨Î˜
  \end{center}
\item[anschauliche Bedeutung:] VerhÃ¤ltnis zwischen in Richtung $Î˜$
  ausgestrahltem und aus Richtung $Î¨$ empfangenen Licht im Punkt $x$

  (eigentlich Quotient aus Strahlungsdichte und BestrahlungsstÃ¤rke)

  \pagebreak
  
  \begin{center}
    \input{fig_renderBRDF2}%Î¸
  \end{center}
\item[notwendige Eigenschaften] fÃ¼r physikalische Korrektheit:
  \begin{itemize}
  \item $f(x, Î˜ â†” Î¨) â‰¥ 0$ \quad (PositivitÃ¤t)
  \item $f(x, Î˜ â†” Î¨) = f(x, Î¨ â†” Î˜)$ \quad (Helmholtz-ReziprozitÃ¤t)
  \item $âˆ«_Î© f(x, Î˜ â†” Î¨) \rk{Náµ€ Â· Î¨} \dd Ï‰ â‰¤ 1$ fÃ¼r alle $Î˜$ \quad (Energieerhaltung)
  \end{itemize}

  \pagebreak
  
\item[BTDF\index{BTDF}:] bidirectional transmittance distribution function, analog
  fÃ¼r lichtdurchlÃ¤ssige Materialien fÃ¼r Bereich unter OberflÃ¤che
  % \imagelink{Grafiken/btdfs}
  \begin{center}
    \input{fig_renderBTDF}
  \end{center}
\item[BSDF\index{BSDF}:] bidirectional scattering distribution function (BRDF +
  BTDF zusammen)
  % \imagelink{Grafiken/complex-bsdf}
  \begin{center}
    \input{fig_renderBSDF}
  \end{center}
\end{description}
\Reached{WS19/20}{13}{2020/01/16}

\pagebreak

\minisec{BRDF: Beispiele}

% \imagelink{Bilder/diffuse}
% \imagelinkadd{Bilder/phong1}
% \imagelinkadd{Bilder/phong2}
% \imagelinkadd{Bilder/phong3}
% \imagelinkadd{Bilder/phong4}
% \imagelinkadd{Bilder/phong5}
% \imagelinkadd{Bilder/phong6}

\begin{description}
\item[diffus (Lambert):] \mbox{}
  \[ f = \frac{R_d}{Ï€} \]
\item[Spiegelung:] \mbox{}
  \[ f = Râ‚› Â· \frac{Î´\fk{Î¨ - S(Î˜, N)}}{Náµ€ Â· Î¨} \]
  ($Î´(0) = 1$, $Î´(w) = 0$ fÃ¼r $w â‰  0$, $S(Î˜, N)$: Spiegelrichtung)

  Damit folgt:
  \[ âˆ«_Î© Râ‚› Â· \frac{Î´\fk{Î¨ - S(Î˜, N)}}{Náµ€ Â· Î¨} Â· L(x â† Î¨) Â· \rk{Náµ€ Â· Î¨} \, \dd Ï‰
    = Râ‚› Â· L(x â† S(Î˜, N)) \]
\item[winkelabhÃ¤ngige Reflexion (Phong):] \mbox{}
  \[ f = R_w Â· \frac{Î½ + 2}{2Ï€} Â· \frac{\rk{S(Î¨, N)áµ€ Â· Î˜}^Î½}{Náµ€ Â· Î¨} \]
\end{description}

\pagebreak

\pngpage{Bilder/yagir/diffuse}
\pngpage[\imglic{}{Martin Galgon, light probe: Bernhard Vogl, \urllic{http://dativ.at/lightprobes/}}%
{}{}]{Bilder/yagir/phong1}
\pngpage[\imglic{}{Martin Galgon, light probe: Bernhard Vogl, \urllic{http://dativ.at/lightprobes/}}%
{}{}]{Bilder/yagir/phong2}
\pngpage[\imglic{}{Martin Galgon, light probe: Bernhard Vogl, \urllic{http://dativ.at/lightprobes/}}%
{}{}]{Bilder/yagir/phong3}
\pngpage[\imglic{}{Martin Galgon, light probe: Bernhard Vogl, \urllic{http://dativ.at/lightprobes/}}%
{}{}]{Bilder/yagir/phong4}
\pngpage[\imglic{}{Martin Galgon, light probe: Bernhard Vogl, \urllic{http://dativ.at/lightprobes/}}%
{}{}]{Bilder/yagir/phong5}
\pngpage[\imglic{}{Martin Galgon, light probe: Bernhard Vogl, \urllic{http://dativ.at/lightprobes/}}%
{}{}]{Bilder/yagir/phong6}

\pagebreak


\subsection{Kombination von BRDFs}

\zB fÃ¼r Glas, glÃ¤nzende OberflÃ¤chen, â€¦
% \imagelink{Bilder/diffuse_mirror}
% \imagelinkadd{Bilder/blue_glass}
% \imagelinkadd{Bilder/plastic_bunny}
% \imagelinkadd{Bilder/art}

\begin{description}
\item[Beobachtung:] Der Anteil gebrochenen und reflektierten Lichts
  hÃ¤ngt vom Winkel ab.

  Beispiel: WasseroberflÃ¤chen spiegeln stÃ¤rker, wenn man aus flachem
  Winkel darauf schaut.

  Berechnung durch fresnelsche Formeln aus parallel und senkrecht zur
  Einfallsebene polarisiertem Licht.
  \ReachedZoom{WS20/21}{12}{2021/01/28}
\item[Verwendung in Path Tracing:] Reflexionsgrad als
  Wahrscheinlichkeit bei der Auswahl zwischen mehreren BRDFs.
\item[komplexere Materialen:] modellierbar durch Schichten von BRDFs
  und Lichttransport dazwischen
  % \imagelink{Grafiken/diffuse-and-reflection}
\end{description}

\begin{center}
  {\small\input{fig_renderCombBRDF}}
\end{center}

\pagebreak

\pngpage[\imglic{}{Martin Galgon, light probe: Bernhard Vogl, \urllic{http://dativ.at/lightprobes/}}%
{}{}]{Bilder/yagir/diffuse-and-mirror}

\pngpage[\imglic{}{Martin Galgon, light probe: Bernhard Vogl, \urllic{http://dativ.at/lightprobes/}}%
{}{}]{Bilder/yagir/blue-glass}

\pngpage[\imglic{}%
{Martin Galgon, Modell: Stanford University Computer Graphics Laboratory, %
  \urllic{http://graphics.stanford.edu/data/3Dscanrep/\#bunny}}%
{}{}]{Bilder/yagir/plastic-bunny}

\pngpage[\imglic{}{Martin Galgon, light probe: Bernhard Vogl, \urllic{http://dativ.at/lightprobes/}}%
{}{}]{Bilder/yagir/art-glass-cuboids}

\pagebreak

\Reached{WS21/22}{12}{2022/01/13}


\subsection{Importance Sampling}%
\index{Importance Sampling}

\[ I â‰ˆ \frac1n âˆ‘áµ¢â‚Œâ‚â¿ \frac{g\fk{xáµ¢}}{p\fk{xáµ¢}} \]

Rendergleichung wird zu:
\[ Lâ‚’áµ¤â‚œ â‰ˆ Lâ‚‘ + \frac{1}{n} âˆ‘áµ¢â‚Œâ‚â¿ \rk{\frac{fáµ¢}{páµ¢} Â· Láµ¢ Â· \rk{Náµ€ Â· Î¨áµ¢}} \]
% \imagelink{Bilder/conv_pt_100spp_uniform}
% \imagelinkadd{Bilder/conv_pt_100spp}
% \imagelinkadd{Bilder/samp_uniform_64spp}
% \imagelinkadd{Bilder/samp_importance_64spp}

Beispiel:
\[ p(Î¨) = \frac{Náµ€ Â· Î¨}{Ï€} \]

\pagebreak

\pngpage{Bilder/yagir/cornell-pt-uniform-100spp}
% Reines Path Tracing, gleichmÃ¤ÃŸige Verteilung der Richtungen. 100 Pfade pro Pixel.

\pngpage{Bilder/yagir/cornell-pt-impsampcostheta-100spp}
% Reines Path Tracing, Verteilung der Richtungen proportional zu cos(theta). 100 Pfade pro Pixel.

\pngpage{Bilder/yagir/cornell-microfacet-uniform-64spp}
% Gleichverteilte Abtastung fÃ¼r Microfacetten nach Phong.

\pngpage{Bilder/yagir/cornell-microfacet-impsamp-64spp}
% Importance Sampling fÃ¼r Microfacetten nach Phong.

% \XXX Zufallszahlen, PDF (Wahrscheinlichkeitsdichtefunktion, probability distribution function),
% CDF (Verteilungsfunktion, cumulative distribution function)

\pagebreak


\subsection{Direkte Beleuchtung}

\begin{description}
\item[Idee:] Bei Punkten in der Szene, bei denen klar ist, dass Sie
  direkt von einer Lichtquelle getroffen werden, soll diese nicht
  zufÃ¤llig gefunden werden mÃ¼ssen.

  
\item[â‡’] Auf\/teilung des Monte-Carlo-Prozesses in zwei Teile
  (direct lighting, next event estimation)
\end{description}

\begin{align*}
  L(x â†’ Î˜) &= Lâ‚‘ + âˆ«_Î© f Â· L(x â† Î¨) Â· \rk{Náµ€ Â· Î¨} \, \dd Ï‰ \\
  &= Lâ‚‘ + âˆ«_{\widehat{Î©}} f Â· Lâ‚‘\fk{x' â†’ -Î¨} Â· \rk{Náµ€ Â· Î¨} \, \dd Ï‰
  + âˆ«_{Î©âˆ–\widehat{Î©}} f Â· L(x â† Î¨) Â· \rk{Náµ€ Â· Î¨} \, \dd Ï‰
\end{align*}
% \imagelink{Bilder/conv_pt_10spp_uniform}
% \imagelinkadd{Bilder/conv_dlpt_10spp}
% \imagelinkadd{Bilder/conv_pt_100spp}%vgl. oben
% \imagelinkadd{Bilder/conv_dlpt_100spp}
 
also indirekter Anteil ohne Emission

\pagebreak

\pngpage{Bilder/yagir/cornell-pt-uniform-10spp}

\pngpage{Bilder/yagir/cornell-pt-directlighting-10spp}

\pngpage{Bilder/yagir/cornell-pt-impsampcostheta-100spp}

\pngpage{Bilder/yagir/cornell-pt-directlighting-100spp}

\pagebreak


\subsection{Multiple Importance Sampling}%
\index{Multiple Importance Sampling}

(nach Veach, 1997)
\personHidden{0mm}{Eric Veach}{}{}%
{Informatiker}%
{person_Veach}{}%
{\urlpers{https://www.rainforesttrust.org/about-us/our-team/}}{}%
% \imagelink{Grafiken/mis}
% \imagelinkadd{Bilder/mis_dl_light_64spp}
% \imagelinkadd{Bilder/mis_dl_brdf_64spp}
% \imagelinkadd{Bilder/mis_200spp}

\begin{description}
\item[Beobachtung 1:] Wahl der Richtungen fÃ¼r direkte Beleuchtung durch Abtasten der
  Lichtquellen gut bei diffusem Material und kleinem Raumwinkel zur Lichtquelle
\item[Beobachtung 2:] Wahl der Richtungen fÃ¼r direkte Beleuchtung
  durch BRDF gut bei glÃ¤nzendem Material und groÃŸem Raumwinkel zur
  Lichtquelle
  \begin{center}
    \input{fig_renderMIS}
  \end{center}
\item[Idee:] kombiniere beides
\item[Frage:] Wie lassen sich beide berechneten Ergebnisse
  kombinieren?

  \pagebreak

\item[Multi-Sample-Modell:] \mbox{}
  \[ I â‰ˆ âˆ‘áµ¢â‚Œâ‚â¿ \frac{1}{náµ¢} âˆ‘â±¼â‚Œâ‚^{náµ¢} wáµ¢\fk{x_{i,j}} \frac{f\fk{x_{i,j}}}{páµ¢\fk{x_{i,j}}} \]
  \begin{tabular}{Ll}
    n & Anzahl verschiedener Sampling-Strategien $páµ¢$ \\
    náµ¢ & Anzahl der Samples fÃ¼r Strategie $i$ \\
    wáµ¢ & Gewichtsfunktion fÃ¼r Samples der Strategie $i$
  \end{tabular}
  
  Wahl der $wáµ¢$ \zB per Balance-Heuristik:
  \[ wáµ¢(x) = \frac{náµ¢ páµ¢(x)}{âˆ‘â‚– nâ‚– pâ‚–(x)} \]

\item[Single-Sample-Modell:] WÃ¤hle Strategie $páµ¢$ mit
  Wahrscheinlichkeit $cáµ¢$.
  \[ I â‰ˆ \frac{wáµ¢\fk{xáµ¢} f\fk{xáµ¢}}{cáµ¢ páµ¢\fk{xáµ¢}} \]
\end{description}

\pagebreak

\pngpage{Bilder/yagir/mis-dl-light-64spp}

\pngpage{Bilder/yagir/mis-dl-brdf-64spp}

\pngpage{Bilder/yagir/mis-dl-light-and-brdf-200spp}

\pagebreak


\vspace*{-26mm}
\subsection{Weiterentwicklungen}

\minisec{Bidirektionales Path Tracing}%
\index{bidirektionales Path Tracing}\index{Path Tracing!bidirektionales}

(Lafortune/Willems 1993, Veach/Guibas 1994)
\personHidden{16mm}{Eric P.~F.~Lafortune}{}{}%
{Informatiker}%
{person_Lafortune}{}%
{\urlpers{http://www.lafortune.eu/}}{}%

\personHidden{1mm}{Yves D.~Willems}{}{}%
{Informatiker}%
{person_Willems}{}%
{\urlpers{https://github.com/yveswillems}}{}%
% {\urlpers{https://www.kuleuven.be/wieiswie/en/person/00009298}}{}% % alt

\person{-14mm}{Leonidas John Guibas (Î›ÎµÏ‰Î½Î¯Î´Î±Ï‚ Î™Ï‰Î¬Î½Î½Î·Ï‚ Î“ÎºÎ¯Î¼Ï€Î±Ï‚ [LeÅnÃ­das IÅÃ¡nnÄ“s GkÃ­mpas])}%
{1949}{}%
{Informatiker}%
{person_Guibas}{Sergio01}%
{\urlpers{https://commons.wikimedia.org/wiki/File:Leonidas_Guibas_2010_06_29.png}}%
{\ccbysa~3.0, \urllic{https://creativecommons.org/licenses/by-sa/3.0/legalcode}}%
\vspace*{-19mm}

\begin{itemize}
\item Konstruiere jeweils zwei Pfade jeweils fester LÃ¤nge:
  %\imagelink{Grafiken/bidir-pt}
  \begin{itemize}
  \item einen ausgehend vom Kamerapunkt
  \item einen ausgehend von einer Lichtquelle
  \end{itemize}
\item Verbinde Zwischenpunkte der Pfade zu vollstÃ¤ndigen Pfaden
  Lichtquelle â€“ Kamerapunkt
\item[\Good] bessere Darstellung von Kaustiken (durch LichtbÃ¼ndelung
  entstehende helle Bereiche)
  \begin{center}
    \input{fig_renderBidiPT}

    hier: gewichteter Mittelwert der Strahlen $\rk{xâ‚€, xâ‚, yâ‚€}$,
    $\rk{xâ‚€, xâ‚, xâ‚‚, yâ‚€}$ (Anteil $0$ wegen Verdeckung),
    $\rk{xâ‚€, xâ‚, yâ‚, yâ‚€}$, $\rk{xâ‚€, xâ‚, xâ‚‚, yâ‚, yâ‚€}$, $\rk{xâ‚€, xâ‚, yâ‚‚, yâ‚, yâ‚€}$, $\rk{xâ‚€, xâ‚, xâ‚‚, yâ‚‚, yâ‚, yâ‚€}$
  \end{center}
\end{itemize}

\pagebreak

\pngpageHidden[\imglic{}%
{\urllic{http://www.edxgraphics.com/uploads/8/5/2/1/8521459/7180718_orig.jpg}}%
{}{}]{Bilder/web/bunny-bidipt-caustics}

\pngpage[\imglic{Alan Leigh-Lancaster}%
{\urllic{https://commons.wikimedia.org/wiki/File:Computer_Generated_Caustics.png}}%
{â€Computer Generated Causticsâ€œ}%
{\ccbysa~3.0, \urllic{https://creativecommons.org/licenses/by-sa/3.0/legalcode}%
}]{Bilder/wikimedia/glass-bidipt-caustics}

\pagebreak

\minisec{Metropolis Light Transport}%
\index{Metropolis Light Transport}

(Veach/Guibas 1997)
\begin{itemize}
\item Erweiterung des bidirektionalen Path Tracings
\item Ist ein â€guterâ€œ Pfad gefunden worden (hoher Beitrag zum Bild),
  betrachte zusÃ¤tzliche Pfade, die sich durch kleine Ã„nderungen ergeben.
  \begin{itemize}
  \item HinzufÃ¼gen eines zusÃ¤tzlichen Punktes zum Pfad
  \item kleine Verschiebungen der Knotenpunkte des Pfads
    %\imagelink{Bilder/mlt-bpt}
  \end{itemize}
\end{itemize}

\Reached{WS16/17}{14}{2017/02/02}

\pagebreak

\pngpageHidden[\imglic{Eric Veach, Leonidas John Guibas}%
{\urllic{https://graphics.stanford.edu/papers/metro/}}%
{}{}]{Bilder/web/mlt-vs-bidipt-magnified}

\pagebreak

\minisec{Photon Mapping}%
\index{Photon Mapping}

(Jensen 1995)
\personHidden{-14mm}{Henrik Wann Jensen}%
{1969, Harlev, DK}{}%
{Computergraphiker}%
{person_Jensen}{}%
{\urlpers{http://graphics.ucsd.edu/~henrik/}}%
{}%

\begin{itemize}
\item zweistufiges Verfahren
\item 1.~Schritt: Aussenden von Lichtpaketen (â€Photonenâ€œ) von den
  Lichtquellen, Speicherung des Ergebnisses in einer Photon Map
  (unabhÃ¤ngig vom Betrachtungspunkt)

  fÃ¼r Kaustiken zusÃ¤tzliche Speicherung einer â€Caustic Mapâ€œ
\item 2.~Schritt: Rendern \zB durch Kombination von diffusem
  Raytracing fÃ¼r direkte Beleuchtung und Information aus Photon Map
  fÃ¼r indirekte Beleuchtung

  auch in Verbindung mit Path Tracing zur Beschleunigung
  
\item Verfahren ist â€biasedâ€œ (keine Konvergenz gegen LÃ¶sung der
  Rendergleichgung durch Mittelwert vieler gerenderter Bilder) aber
  Konvergenz mit zunehmender Anzahl an Photonen
\end{itemize}

\pagebreak

\pngpage[\imglic{Purpy Pupple}%
{\urllic{https://commons.wikimedia.org/wiki/File:Glass_ochem.png}}%
{â€Glass ochemâ€œ}%
{\ccbysa~3.0, \urllic{https://creativecommons.org/licenses/by-sa/3.0/legalcode}%
}]{Bilder/wikimedia/glass-molecule-photonmapping}

\pngpage[\imglic{Tobias R Metoc}%
{\urllic{https://commons.wikimedia.org/wiki/File:Glas-2000-enery.jpg}}%
{â€Glas-2000-eneryâ€œ}%
{\ccbysa~2.5, \urllic{https://creativecommons.org/licenses/by-sa/2.5/legalcode}%
}]{Bilder/wikimedia/glass-en2000-photonmapping}

\mbox{}
\Reached{WS17/18}{14}{2018/01/25}
\Reached{WS18/19}{13}{2019/01/24}
\Reached{WS19/20}{14}{2020/01/23}
\ReachedZoom{WS20/21}{13}{2021/02/04}
\Reached{WS21/22}{13}{2022/01/20}
